{"version":3,"sources":["casa_financas/subs.cljs"],"mappings":"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","names":["re_frame.core.reg_sub","db","_","casa-financas.subs/mes-estritamente-anterior?","ano","mes","ano-ref","mes-ref","cljs.core._EQ_","p__16994","vec__16995","cljs.core.nth","despesas","cljs.core.filter","d","p__16998","vec__16999","entradas","e","parts","clojure.string.split","cljs.core/first","m","cljs.core/second","cljs.core.reduce","cljs.core/+","cljs.core.map","p__17003","vec__17004","desp-ant","p1__17002#","entr-ant","total-entr","total-desp","p__17009","vec__17010","pessoa-id","p1__17007#","p1__17008#","debitos","pct","cljs.core.get","cljs.core.keyword","p__17013","vec__17014","configs","G__17017"],"sourcesContent":["(ns casa-financas.subs\r\n  (:require [re-frame.core :as rf]))\r\n\r\n(rf/reg-sub :aba-ativa     (fn [db _] (:aba-ativa db)))\r\n(rf/reg-sub :mes-atual     (fn [db _] (:mes-atual db)))\r\n(rf/reg-sub :usuario-atual (fn [db _] (:usuario-atual db)))\r\n(rf/reg-sub :pessoa-ativa  (fn [db _] (:pessoa-ativa db)))\r\n(rf/reg-sub :modal         (fn [db _] (:modal db)))\r\n(rf/reg-sub :loading       (fn [db _] (:loading db)))\r\n(rf/reg-sub :erro          (fn [db _] (:erro db)))\r\n(rf/reg-sub :despesas      (fn [db _] (:despesas db)))\r\n(rf/reg-sub :entradas      (fn [db _] (:entradas db)))\r\n(rf/reg-sub :templates     (fn [db _] (:templates db)))\r\n(rf/reg-sub :categorias    (fn [db _] (:categorias db)))\r\n(rf/reg-sub :despesas-historico (fn [db _] (:despesas-historico db)))\r\n(rf/reg-sub :entradas-historico (fn [db _] (:entradas-historico db)))\r\n\r\n(defn mes-estritamente-anterior? [ano mes ano-ref mes-ref]\r\n  (or (< ano ano-ref)\r\n      (and (= ano ano-ref) (< mes mes-ref))))\r\n\r\n(rf/reg-sub\r\n :despesas-do-mes\r\n :<- [:despesas]\r\n :<- [:mes-atual]\r\n (fn [[despesas mes] _]\r\n   (filter (fn [d]\r\n             (and (= (:ano d) (:ano mes))\r\n                  (= (:mes d) (:mes mes))))\r\n           despesas)))\r\n\r\n(rf/reg-sub\r\n :entradas-do-mes\r\n :<- [:entradas]\r\n :<- [:mes-atual]\r\n (fn [[entradas mes] _]\r\n   (filter (fn [e]\r\n             (when (:data e)\r\n               (let [parts (clojure.string/split (:data e) #\"-\")\r\n                     ano   (int (first parts))\r\n                     m     (int (second parts))]\r\n                 (and (= ano (:ano mes))\r\n                      (= m (:mes mes))))))\r\n           entradas)))\r\n\r\n(rf/reg-sub\r\n :total-previsto-mes\r\n :<- [:despesas-do-mes]\r\n (fn [despesas _]\r\n   (reduce + 0 (map :valor despesas))))\r\n\r\n(rf/reg-sub\r\n :total-pago-mes\r\n :<- [:despesas-do-mes]\r\n (fn [despesas _]\r\n   (reduce + 0 (map :valor (filter :pago despesas)))))\r\n\r\n(rf/reg-sub\r\n :total-entradas-mes\r\n :<- [:entradas-do-mes]\r\n (fn [entradas _]\r\n   (reduce + 0 (map :valor entradas))))\r\n\r\n(rf/reg-sub\r\n :saldo-acumulado-anterior\r\n :<- [:despesas-historico]\r\n :<- [:entradas-historico]\r\n :<- [:mes-atual]\r\n (fn [[despesas entradas mes] _]\r\n   (let [desp-ant (filter #(mes-estritamente-anterior?\r\n                             (:ano %) (:mes %)\r\n                             (:ano mes) (:mes mes))\r\n                          despesas)\r\n         entr-ant (filter (fn [e]\r\n                            (when (:data e)\r\n                              (let [parts (clojure.string/split (:data e) #\"-\")\r\n                                    ano   (int (first parts))\r\n                                    m     (int (second parts))]\r\n                                (mes-estritamente-anterior?\r\n                                  ano m (:ano mes) (:mes mes)))))\r\n                          entradas)\r\n         total-entr (reduce + 0 (map :valor entr-ant))\r\n         total-desp (reduce + 0 (map :valor desp-ant))]\r\n     (- total-entr total-desp))))\r\n\r\n(rf/reg-sub\r\n :saldo-acumulado-anterior-pessoa\r\n (fn [db [_ pessoa-id]]\r\n   (let [mes      (:mes-atual db)\r\n         despesas (filter #(mes-estritamente-anterior?\r\n                            (:ano %) (:mes %)\r\n                            (:ano mes) (:mes mes))\r\n                          (:despesas-historico db))\r\n         entradas (filter (fn [e]\r\n                            (when (:data e)\r\n                              (let [parts (clojure.string/split (:data e) #\"-\")\r\n                                    ano   (int (first parts))\r\n                                    m     (int (second parts))]\r\n                                (mes-estritamente-anterior?\r\n                                 ano m (:ano mes) (:mes mes)))))\r\n                          (:entradas-historico db))\r\n         total-entr (reduce + 0\r\n                            (map :valor\r\n                                 (filter #(= (:pessoa_id %) pessoa-id) entradas)))\r\n         debitos    (reduce + 0\r\n                            (map (fn [d]\r\n                                   (let [pct (get (:divisao d) (keyword pessoa-id) 0)]\r\n                                     (* (:valor d) (/ pct 100))))\r\n                                 despesas))]\r\n     (- total-entr debitos))))\r\n\r\n(rf/reg-sub\r\n :configuracoes\r\n (fn [db _]\r\n   (:configuracoes db)))\r\n\r\n(rf/reg-sub\r\n :cor-pessoa\r\n :<- [:configuracoes]\r\n (fn [configs [_ pessoa-id]]\r\n   (get configs (str \"cor_\" pessoa-id)\r\n        (case pessoa-id\r\n          \"andre\"    \"#3B82F6\"\r\n          \"bianca\"   \"#EC4899\"\r\n          \"fernanda\" \"#14B8A6\"\r\n          \"bruna\"    \"#F97316\"\r\n          \"#9CA3AF\"))))"]}