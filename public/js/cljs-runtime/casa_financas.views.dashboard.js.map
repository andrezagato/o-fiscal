{"version":3,"sources":["casa_financas/views/dashboard.cljs"],"mappings":"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","names":["casa-financas.views.dashboard/pessoas-ids","casa-financas.views.dashboard/calcular-saldo-pessoa","pessoa-id","despesas","entradas","entradas-pessoa","p1__17167#","cljs.core.filter","cljs.core._EQ_","total-entradas","cljs.core.reduce","cljs.core/+","cljs.core.map","debitos","d","pct","cljs.core.get","cljs.core.keyword","casa-financas.views.dashboard/card-pessoa","despesas-mes","entradas-mes","cljs.core/deref","cor","casa-financas.utils/pessoa-cor","saldo-mes","saldo-ant","re_frame.core.subscribe","saldo-total","entradas-p","p1__17204#","previsto","pago","cljs.core.min","casa-financas.components.comum/avatar","casa-financas.utils/formatar-valor-br","casa-financas.views.dashboard/dashboard","total-prev","total-pago","total-entr","pct-pago","casa-financas.components.comum/seletor-mes","iter__5628__auto__","s__17269","cljs.core/LazySeq","temp__5823__auto__","cljs.core/seq","cljs.core/chunked-seq?","c__5626__auto__","size__5627__auto__","cljs.core/count","b__17271","cljs.core/chunk-buffer","i__17270","cljs.core/-nth","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__17268","cljs.core/chunk-rest","cljs.core/first","cljs.core/cons","cljs.core/rest","pid","cljs.core/chunk-first"],"sourcesContent":["(ns casa-financas.views.dashboard\r\n  (:require [re-frame.core :as rf]\r\n            [casa-financas.utils :as u]\r\n            [casa-financas.components.comum :as c]))\r\n\r\n(def pessoas-ids [\"andre\" \"bianca\" \"fernanda\" \"bruna\"])\r\n\r\n(defn calcular-saldo-pessoa [pessoa-id despesas entradas]\r\n  (let [entradas-pessoa (filter #(= (:pessoa_id %) pessoa-id) entradas)\r\n        total-entradas  (reduce + 0 (map :valor entradas-pessoa))\r\n        debitos         (reduce + 0\r\n                                (map (fn [d]\r\n                                       (let [pct (get (:divisao d) (keyword pessoa-id) 0)]\r\n                                         (* (:valor d) (/ pct 100))))\r\n                                     despesas))]\r\n    (- total-entradas debitos)))\r\n\r\n(defn card-pessoa [pessoa-id despesas-mes entradas-mes]\r\n  (let [cor        (u/pessoa-cor pessoa-id)\r\n        saldo-mes  (calcular-saldo-pessoa pessoa-id despesas-mes entradas-mes)\r\n        saldo-ant  @(rf/subscribe [:saldo-acumulado-anterior-pessoa pessoa-id])\r\n        saldo-total (+ saldo-mes saldo-ant)\r\n        entradas-p (reduce + 0 (map :valor (filter #(= (:pessoa_id %) pessoa-id) entradas-mes)))\r\n        previsto   (reduce + 0\r\n                           (map (fn [d]\r\n                                  (* (:valor d)\r\n                                     (/ (get (:divisao d) (keyword pessoa-id) 0) 100)))\r\n                                despesas-mes))\r\n        pago       (reduce + 0\r\n                           (map (fn [d]\r\n                                  (if (:pago d)\r\n                                    (* (:valor d)\r\n                                       (/ (get (:divisao d) (keyword pessoa-id) 0) 100))\r\n                                    0))\r\n                                despesas-mes))\r\n        pct        (if (> previsto 0) (min 100 (int (* 100 (/ pago previsto)))) 0)]\r\n    [:div {:class \"rounded-xl p-3 shadow-sm border\"\r\n           :style {:background-color (str (u/pessoa-cor pessoa-id) \"0D\")\r\n                   :border-color     (str (u/pessoa-cor pessoa-id) \"66\")}}\r\n     ;; Header \u2014 avatar + saldo total\r\n     [:div {:class \"flex items-center gap-2 mb-2\"}\r\n      [c/avatar pessoa-id {:size \"sm\"}]\r\n      [:p {:class (str \"text-base font-bold \"\r\n                       (if (>= saldo-total 0) \"text-green-600\" \"text-red-500\"))}\r\n       (u/formatar-valor-br saldo-total)]]\r\n     ;; Detalhes\r\n     [:div {:class \"space-y-1.5 text-xs\"}\r\n      [:div {:class \"flex justify-between text-gray-500\"}\r\n       [:span \"Entradas\"] [:span {:class \"text-green-600\"} (u/formatar-valor-br entradas-p)]]\r\n      [:div {:class \"flex justify-between text-gray-500\"}\r\n       [:span \"Previsto\"] [:span (u/formatar-valor-br previsto)]]\r\n      [:div {:class \"flex justify-between text-gray-400\"}\r\n       [:span \"Saldo Ant.\"] [:span {:class (if (>= saldo-ant 0) \"text-green-600\" \"text-red-500\")}\r\n        (u/formatar-valor-br saldo-ant)]]]]))\r\n\r\n(defn dashboard []\r\n  (let [despesas-mes @(rf/subscribe [:despesas-do-mes])\r\n        entradas-mes @(rf/subscribe [:entradas-do-mes])\r\n        total-prev   @(rf/subscribe [:total-previsto-mes])\r\n        total-pago   @(rf/subscribe [:total-pago-mes])\r\n        total-entr   @(rf/subscribe [:total-entradas-mes])\r\n        saldo-ant    @(rf/subscribe [:saldo-acumulado-anterior])\r\n        saldo-total  (+ (- total-entr total-pago) saldo-ant)\r\n        pct-pago     (if (> total-prev 0)\r\n                       (min 100 (int (* 100 (/ total-pago total-prev))))\r\n                       0)]\r\n    [:div {:class \"flex flex-col pb-24\"}\r\n     [c/seletor-mes]\r\n     [:div {:class \"flex flex-col gap-3 p-3\"}\r\n      ;; Card principal\r\n      [:div {:class \"bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl p-4 text-white shadow-md\"}\r\n       [:p {:class \"text-blue-100 text-xs mb-0.5\"} \"Saldo Total\"]\r\n       [:p {:class \"text-3xl font-bold mb-3\"} (u/formatar-valor-br saldo-total)]\r\n       ;; Barra de progresso\r\n       [:div {:class \"w-full bg-blue-400 rounded-full h-1.5 mb-3\"}\r\n        [:div {:class \"h-1.5 rounded-full bg-white transition-all\"\r\n               :style {:width (str pct-pago \"%\")}}]]\r\n       ;; 3 n\u00fameros em linha\r\n       [:div {:class \"grid grid-cols-3 gap-2 text-center\"}\r\n        [:div\r\n         [:p {:class \"text-blue-100 text-xs\"} \"Entradas\"]\r\n         [:p {:class \"text-white font-semibold text-sm\"} (u/formatar-valor-br total-entr)]]\r\n        [:div\r\n         [:p {:class \"text-blue-100 text-xs\"} \"Pago\"]\r\n         [:p {:class \"text-white font-semibold text-sm\"} (str (u/formatar-valor-br total-pago) \" (\" pct-pago \"%)\")]]\r\n        [:div\r\n         [:p {:class \"text-blue-100 text-xs\"} \"Previsto\"]\r\n         [:p {:class \"text-white font-semibold text-sm\"} (u/formatar-valor-br total-prev)]]]\r\n       ;; Meses anteriores\r\n       [:div {:class \"mt-2 pt-2 border-t border-blue-400 flex justify-between\"}\r\n        [:p {:class \"text-blue-100 text-xs\"} \"Meses anteriores\"]\r\n        [:p {:class \"text-white text-xs font-medium\"} (u/formatar-valor-br saldo-ant)]]]\r\n\r\n      ;; Cards por pessoa\r\n      [:div {:class \"grid grid-cols-2 gap-2\"}\r\n       (for [pid pessoas-ids]\r\n         ^{:key pid}\r\n         [card-pessoa pid despesas-mes entradas-mes])]]]))"]}