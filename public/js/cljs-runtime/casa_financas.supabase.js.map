{"version":3,"sources":["casa_financas/supabase.cljs"],"mappings":"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","names":["js/casa-financas","js/casa-financas.supabase","js/casa-financas.supabase.client","casa-financas.supabase/client","js/module$node_modules$$supabase$supabase_js$dist$index_cjs.createClient","casa-financas.config/supabase-url","casa-financas.config/supabase-anon-key","casa-financas.supabase/login!","email","senha","callback","p1__28299#","G__28301","cljs.core.js__GT_clj","p1__28300#","G__28302","casa-financas.supabase/logout!","p1__28303#","G__28304","casa-financas.supabase/sessao-atual","p1__28305#","G__28306","casa-financas.supabase/on-auth-change","event","session","G__28307","G__28308","casa-financas.supabase/buscar-despesas!","ano","mes","res","data","G__28310","cljs.core.mapv","d","cljs.core.assoc","p1__28309#","js/console.error","casa-financas.supabase/salvar-despesa!","despesa","row","cljs.core/clj->js","cljs.core.get_in","p1__28311#","G__28312","casa-financas.supabase/marcar-pago!","id","js/Date","p1__28313#","G__28314","casa-financas.supabase/buscar-entradas!","inicio","prox-mes","cljs.core._EQ_","prox-ano","fim","G__28317","e","p1__28315#","cljs.core.update","js/parseFloat","p1__28316#","casa-financas.supabase/salvar-entrada!","entrada","p1__28318#","G__28319","casa-financas.supabase/buscar-templates!","G__28321","t","p1__28320#","casa-financas.supabase/salvar-template!","template","p1__28322#","G__28323","casa-financas.supabase/toggle-template!","ativo","p1__28324#","G__28325","casa-financas.supabase/deletar!","tabela","js/console.log","p1__28326#","casa-financas.supabase/desmarcar-pago!","p1__28327#","G__28328","casa-financas.supabase/deletar-entradas-auto!","despesa-id","p1__28329#","casa-financas.supabase/buscar-todas-despesas!","G__28331","p1__28330#","casa-financas.supabase/buscar-todas-entradas!","G__28334","p1__28332#","p1__28333#","casa-financas.supabase/buscar-configuracoes!","G__28336","cljs.core.reduce","acc","item","p1__28335#","casa-financas.supabase/salvar-configuracao!","chave","valor","p1__28337#","casa-financas.supabase/buscar-categorias!","G__28339","p1__28338#","casa-financas.supabase/salvar-categoria!","categoria","p1__28340#","casa-financas.supabase/buscar-fatura!","G__28342","cljs.core/first","p1__28341#","casa-financas.supabase/salvar-fatura!","fatura","p1__28343#","G__28344","casa-financas.supabase/desmarcar-creditos!","p1__28345#","G__28346"],"sourcesContent":["(ns casa-financas.supabase\n  (:require [\"@supabase/supabase-js\" :as sb]\n            [casa-financas.config :as cfg]))\n\n(defonce client\n  (sb/createClient cfg/supabase-url cfg/supabase-anon-key))\n\n;; -- Auth --\n(defn login! [email senha callback]\n  (-> (.signInWithPassword (.-auth client)\n                           #js {:email email :password senha})\n      (.then #(callback (js->clj % :keywordize-keys true)))\n      (.catch #(callback {:error %}))))\n\n(defn logout! [callback]\n  (-> (.signOut (.-auth client))\n      (.then #(callback nil))\n      (.catch #(callback {:error %}))))\n\n(defn sessao-atual [callback]\n  (-> (.getSession (.-auth client))\n      (.then #(callback (js->clj % :keywordize-keys true)))))\n\n(defn on-auth-change [callback]\n  (.onAuthStateChange (.-auth client)\n                      (fn [event session]\n                        (callback event (js->clj session :keywordize-keys true)))))\n\n;; -- Despesas --\n(defn buscar-despesas! [ano mes callback]\n  (-> (.from client \"despesa_mensal\")\n      (.select \"*\")\n      (.eq \"ano\" ano)\n      (.eq \"mes\" mes)\n      (.then (fn [res]\n               (let [data (js->clj (.-data res) :keywordize-keys true)]\n                 (callback (mapv (fn [d]\n                                   (assoc d :divisao\n                                          {:andre    (:divisao_andre d)\n                                           :bianca   (:divisao_bianca d)\n                                           :fernanda (:divisao_fernanda d)\n                                           :bruna    (:divisao_bruna d)}))\n                                 data)))))\n      (.catch #(js/console.error \"Erro ao buscar despesas\" %))))\n\n(defn salvar-despesa! [despesa callback]\n  (let [row #js {:id                 (:id despesa)\n                 :ano                (:ano despesa)\n                 :mes                (:mes despesa)\n                 :descricao          (:descricao despesa)\n                 :valor              (:valor despesa)\n                 :dia_do_mes         (:dia_do_mes despesa)\n                 :forma_pagamento    (:forma_pagamento despesa)\n                 :pagadores          (clj->js (:pagadores despesa))\n                 :divisao_andre      (get-in despesa [:divisao :andre] 0)\n                 :divisao_bianca     (get-in despesa [:divisao :bianca] 0)\n                 :divisao_fernanda   (get-in despesa [:divisao :fernanda] 0)\n                 :divisao_bruna      (get-in despesa [:divisao :bruna] 0)\n                 :pago               (:pago despesa)\n                 :data_pagamento     (:data_pagamento despesa)\n                 :origem_template_id (:origem_template_id despesa)\n                 :categoria_id       (:categoria_id despesa)\n                 :categoria_nome     (:categoria_nome despesa)\n                 :mes_compra         (:mes_compra despesa)\n                 :ano_compra         (:ano_compra despesa)}]\n    (-> (.from client \"despesa_mensal\")\n        (.upsert row)\n        (.then #(callback nil))\n        (.catch #(callback {:error %})))))\n\n(defn marcar-pago! [id callback]\n  (-> (.from client \"despesa_mensal\")\n      (.update #js {:pago true :data_pagamento (.toISOString (js/Date.))})\n      (.eq \"id\" id)\n      (.then #(callback nil))\n      (.catch #(callback {:error %}))))\n\n;; -- Entradas --\n(defn buscar-entradas! [ano mes callback]\n  (let [inicio    (str ano \"-\" (when (< mes 10) \"0\") mes \"-01\")\n        prox-mes  (if (= mes 12) 1 (inc mes))\n        prox-ano  (if (= mes 12) (inc ano) ano)\n        fim       (str prox-ano \"-\" (when (< prox-mes 10) \"0\") prox-mes \"-01\")]\n    (-> (.from client \"entradas\")\n        (.select \"*\")\n        (.gte \"data\" inicio)\n        (.lt \"data\" fim)\n        (.then (fn [res]\n                 (let [data (js->clj (.-data res) :keywordize-keys true)]\n                   (callback (mapv (fn [e]\n                                     (update e :valor #(js/parseFloat %)))\n                                   data)))))\n        (.catch #(js/console.error \"Erro ao buscar entradas\" %)))))\n\n(defn salvar-entrada! [entrada callback]\n  (let [row #js {:id        (:id entrada)\n                 :pessoa_id (:pessoa_id entrada)\n                 :valor     (:valor entrada)\n                 :data      (:data entrada)\n                 :descricao (:descricao entrada)}]\n    (-> (.from client \"entradas\")\n        (.upsert row)\n        (.then #(callback nil))\n        (.catch #(callback {:error %})))))\n\n;; -- Templates --\n(defn buscar-templates! [callback]\n  (-> (.from client \"template_despesa\")\n      (.select \"*\")\n      (.then (fn [res]\n               (let [data (js->clj (.-data res) :keywordize-keys true)]\n                 (callback (mapv (fn [t]\n                                   (assoc t :divisao\n                                          {:andre    (:divisao_andre t)\n                                           :bianca   (:divisao_bianca t)\n                                           :fernanda (:divisao_fernanda t)\n                                           :bruna    (:divisao_bruna t)}))\n                                 data)))))\n      (.catch #(js/console.error \"Erro ao buscar templates\" %))))\n\n(defn salvar-template! [template callback]\n  (let [row #js {:id                      (:id template)\n                 :descricao               (:descricao template)\n                 :valor_padrao            (:valor_padrao template)\n                 :forma_pagamento_padrao  (:forma_pagamento_padrao template)\n                 :pagador_padrao          (clj->js (:pagador_padrao template))\n                 :divisao_andre           (get-in template [:divisao :andre] 0)\n                 :divisao_bianca          (get-in template [:divisao :bianca] 0)\n                 :divisao_fernanda        (get-in template [:divisao :fernanda] 0)\n                 :divisao_bruna           (get-in template [:divisao :bruna] 0)\n                 :ativo                   (:ativo template)\n                 :categoria_id            (:categoria_id template)\n                 :categoria_nome          (:categoria_nome template)}]\n    (-> (.from client \"template_despesa\")\n        (.upsert row)\n        (.then #(callback nil))\n        (.catch #(callback {:error %})))))\n\n(defn toggle-template! [id ativo callback]\n  (-> (.from client \"template_despesa\")\n      (.update #js {:ativo ativo})\n      (.eq \"id\" id)\n      (.then #(callback nil))\n      (.catch #(callback {:error %}))))\n\n(defn deletar! [tabela id]\n  (-> (.from client tabela)\n      (.delete)\n      (.eq \"id\" id)\n      (.then #(js/console.log \"Deletado\" tabela id))\n      (.catch #(js/console.error \"Erro ao deletar\" tabela id %))))\n\n(defn desmarcar-pago! [id callback]\n  (-> (.from client \"despesa_mensal\")\n      (.update #js {:pago false :data_pagamento nil})\n      (.eq \"id\" id)\n      (.then #(callback nil))\n      (.catch #(callback {:error %}))))\n\n(defn deletar-entradas-auto! [despesa-id]\n  (-> (.from client \"entradas\")\n      (.delete)\n      (.eq \"despesa_ref\" despesa-id)\n      (.then #(js/console.log \"Entradas auto deletadas\" despesa-id))\n      (.catch #(js/console.error \"Erro ao deletar entradas auto\" %))))\n\n(defn buscar-todas-despesas! [callback]\n  (-> (.from client \"despesa_mensal\")\n      (.select \"*\")\n      (.then (fn [res]\n               (let [data (js->clj (.-data res) :keywordize-keys true)]\n                 (callback (mapv (fn [d]\n                                   (assoc d :divisao\n                                          {:andre    (:divisao_andre d)\n                                           :bianca   (:divisao_bianca d)\n                                           :fernanda (:divisao_fernanda d)\n                                           :bruna    (:divisao_bruna d)}))\n                                 data)))))\n      (.catch #(js/console.error \"Erro ao buscar historico despesas\" %))))\n\n(defn buscar-todas-entradas! [callback]\n  (-> (.from client \"entradas\")\n      (.select \"*\")\n      (.then (fn [res]\n               (let [data (js->clj (.-data res) :keywordize-keys true)]\n                 (callback (mapv (fn [e]\n                                   (update e :valor #(js/parseFloat %)))\n                                 data)))))\n      (.catch #(js/console.error \"Erro ao buscar historico entradas\" %))))\n\n(defn buscar-configuracoes! [callback]\n  (-> (.from client \"configuracoes\")\n      (.select \"*\")\n      (.then (fn [res]\n               (let [data (js->clj (.-data res) :keywordize-keys true)]\n                 (callback (reduce (fn [acc item]\n                                     (assoc acc (:chave item) (:valor item)))\n                                   {}\n                                   data)))))\n      (.catch #(js/console.error \"Erro ao buscar configuracoes\" %))))\n\n(defn salvar-configuracao! [chave valor callback]\n  (-> (.from client \"configuracoes\")\n      (.upsert #js {:chave chave :valor valor})\n      (.then #(callback))\n      (.catch #(js/console.error \"Erro ao salvar configuracao\" %))))\n\n\n(defn buscar-categorias! [callback]\n  (-> (.from client \"categorias\")\n      (.select \"*\")\n      (.order \"ordem\")\n      (.then (fn [res]\n               (callback (js->clj (.-data res) :keywordize-keys true))))\n      (.catch #(js/console.error \"Erro ao buscar categorias\" %))))\n\n(defn salvar-categoria! [categoria callback]\n  (-> (.from client \"categorias\")\n      (.insert #js {:nome  (:nome categoria)\n                    :emoji (:emoji categoria)\n                    :ordem (:ordem categoria)})\n      (.then #(callback))\n      (.catch #(js/console.error \"Erro ao salvar categoria\" %))))\n\n(defn buscar-fatura! [ano mes callback]\n  (-> (.from client \"fatura_cartao\")\n      (.select \"*\")\n      (.eq \"ano\" ano)\n      (.eq \"mes\" mes)\n      (.then (fn [res]\n               (let [data (js->clj (.-data res) :keywordize-keys true)]\n                 (callback (first data)))))\n      (.catch #(js/console.error \"Erro ao buscar fatura\" %))))\n\n(defn salvar-fatura! [fatura callback]\n  (let [row #js {:id              (:id fatura)\n                 :ano             (:ano fatura)\n                 :mes             (:mes fatura)\n                 :valor_total     (:valor_total fatura)\n                 :valor_pago      (:valor_pago fatura)\n                 :divisao_andre   (:divisao_andre fatura)\n                 :divisao_bianca  (:divisao_bianca fatura)\n                 :divisao_fernanda (:divisao_fernanda fatura)\n                 :divisao_bruna   (:divisao_bruna fatura)}]\n    (-> (.from client \"fatura_cartao\")\n        (.upsert row)\n        (.then #(callback nil))\n        (.catch #(callback {:error %})))))\n\n(defn desmarcar-creditos! [ano mes callback]\n  (-> (.from client \"despesa_mensal\")\n      (.update #js {:pago false :data_pagamento nil})\n      (.eq \"ano\" ano)\n      (.eq \"mes\" mes)\n      (.eq \"forma_pagamento\" \"credito\")\n      (.then #(callback nil))\n      (.catch #(callback {:error %}))))"]}