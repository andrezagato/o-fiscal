{
"version":3,
"file":"module$node_modules$$supabase$realtime_js$dist$main$RealtimeChannel.js",
"lineCount":349,
"mappings":"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",
"sources":["node_modules/@supabase/realtime-js/dist/main/RealtimeChannel.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$$supabase$realtime_js$dist$main$RealtimeChannel\"] = function(require,module,exports) {\n\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.REALTIME_CHANNEL_STATES = exports.REALTIME_SUBSCRIBE_STATES = exports.REALTIME_LISTEN_TYPES = exports.REALTIME_POSTGRES_CHANGES_LISTEN_EVENT = void 0;\r\nconst tslib_1 = require(\"tslib\");\r\nconst constants_1 = require(\"./lib/constants\");\r\nconst push_1 = tslib_1.__importDefault(require(\"./lib/push\"));\r\nconst timer_1 = tslib_1.__importDefault(require(\"./lib/timer\"));\r\nconst RealtimePresence_1 = tslib_1.__importDefault(require(\"./RealtimePresence\"));\r\nconst Transformers = tslib_1.__importStar(require(\"./lib/transformers\"));\r\nconst transformers_1 = require(\"./lib/transformers\");\r\nvar REALTIME_POSTGRES_CHANGES_LISTEN_EVENT;\r\n(function (REALTIME_POSTGRES_CHANGES_LISTEN_EVENT) {\r\n    REALTIME_POSTGRES_CHANGES_LISTEN_EVENT[\"ALL\"] = \"*\";\r\n    REALTIME_POSTGRES_CHANGES_LISTEN_EVENT[\"INSERT\"] = \"INSERT\";\r\n    REALTIME_POSTGRES_CHANGES_LISTEN_EVENT[\"UPDATE\"] = \"UPDATE\";\r\n    REALTIME_POSTGRES_CHANGES_LISTEN_EVENT[\"DELETE\"] = \"DELETE\";\r\n})(REALTIME_POSTGRES_CHANGES_LISTEN_EVENT || (exports.REALTIME_POSTGRES_CHANGES_LISTEN_EVENT = REALTIME_POSTGRES_CHANGES_LISTEN_EVENT = {}));\r\nvar REALTIME_LISTEN_TYPES;\r\n(function (REALTIME_LISTEN_TYPES) {\r\n    REALTIME_LISTEN_TYPES[\"BROADCAST\"] = \"broadcast\";\r\n    REALTIME_LISTEN_TYPES[\"PRESENCE\"] = \"presence\";\r\n    REALTIME_LISTEN_TYPES[\"POSTGRES_CHANGES\"] = \"postgres_changes\";\r\n    REALTIME_LISTEN_TYPES[\"SYSTEM\"] = \"system\";\r\n})(REALTIME_LISTEN_TYPES || (exports.REALTIME_LISTEN_TYPES = REALTIME_LISTEN_TYPES = {}));\r\nvar REALTIME_SUBSCRIBE_STATES;\r\n(function (REALTIME_SUBSCRIBE_STATES) {\r\n    REALTIME_SUBSCRIBE_STATES[\"SUBSCRIBED\"] = \"SUBSCRIBED\";\r\n    REALTIME_SUBSCRIBE_STATES[\"TIMED_OUT\"] = \"TIMED_OUT\";\r\n    REALTIME_SUBSCRIBE_STATES[\"CLOSED\"] = \"CLOSED\";\r\n    REALTIME_SUBSCRIBE_STATES[\"CHANNEL_ERROR\"] = \"CHANNEL_ERROR\";\r\n})(REALTIME_SUBSCRIBE_STATES || (exports.REALTIME_SUBSCRIBE_STATES = REALTIME_SUBSCRIBE_STATES = {}));\r\nexports.REALTIME_CHANNEL_STATES = constants_1.CHANNEL_STATES;\r\n/** A channel is the basic building block of Realtime\r\n * and narrows the scope of data flow to subscribed clients.\r\n * You can think of a channel as a chatroom where participants are able to see who's online\r\n * and send and receive messages.\r\n */\r\nclass RealtimeChannel {\r\n    /**\r\n     * Creates a channel that can broadcast messages, sync presence, and listen to Postgres changes.\r\n     *\r\n     * The topic determines which realtime stream you are subscribing to. Config options let you\r\n     * enable acknowledgement for broadcasts, presence tracking, or private channels.\r\n     *\r\n     * @example\r\n     * ```ts\r\n     * import RealtimeClient from '@supabase/realtime-js'\r\n     *\r\n     * const client = new RealtimeClient('https://xyzcompany.supabase.co/realtime/v1', {\r\n     *   params: { apikey: 'public-anon-key' },\r\n     * })\r\n     * const channel = new RealtimeChannel('realtime:public:messages', { config: {} }, client)\r\n     * ```\r\n     */\r\n    constructor(\r\n    /** Topic name can be any string. */\r\n    topic, params = { config: {} }, socket) {\r\n        var _a, _b;\r\n        this.topic = topic;\r\n        this.params = params;\r\n        this.socket = socket;\r\n        this.bindings = {};\r\n        this.state = constants_1.CHANNEL_STATES.closed;\r\n        this.joinedOnce = false;\r\n        this.pushBuffer = [];\r\n        this.subTopic = topic.replace(/^realtime:/i, '');\r\n        this.params.config = Object.assign({\r\n            broadcast: { ack: false, self: false },\r\n            presence: { key: '', enabled: false },\r\n            private: false,\r\n        }, params.config);\r\n        this.timeout = this.socket.timeout;\r\n        this.joinPush = new push_1.default(this, constants_1.CHANNEL_EVENTS.join, this.params, this.timeout);\r\n        this.rejoinTimer = new timer_1.default(() => this._rejoinUntilConnected(), this.socket.reconnectAfterMs);\r\n        this.joinPush.receive('ok', () => {\r\n            this.state = constants_1.CHANNEL_STATES.joined;\r\n            this.rejoinTimer.reset();\r\n            this.pushBuffer.forEach((pushEvent) => pushEvent.send());\r\n            this.pushBuffer = [];\r\n        });\r\n        this._onClose(() => {\r\n            this.rejoinTimer.reset();\r\n            this.socket.log('channel', `close ${this.topic} ${this._joinRef()}`);\r\n            this.state = constants_1.CHANNEL_STATES.closed;\r\n            this.socket._remove(this);\r\n        });\r\n        this._onError((reason) => {\r\n            if (this._isLeaving() || this._isClosed()) {\r\n                return;\r\n            }\r\n            this.socket.log('channel', `error ${this.topic}`, reason);\r\n            this.state = constants_1.CHANNEL_STATES.errored;\r\n            this.rejoinTimer.scheduleTimeout();\r\n        });\r\n        this.joinPush.receive('timeout', () => {\r\n            if (!this._isJoining()) {\r\n                return;\r\n            }\r\n            this.socket.log('channel', `timeout ${this.topic}`, this.joinPush.timeout);\r\n            this.state = constants_1.CHANNEL_STATES.errored;\r\n            this.rejoinTimer.scheduleTimeout();\r\n        });\r\n        this.joinPush.receive('error', (reason) => {\r\n            if (this._isLeaving() || this._isClosed()) {\r\n                return;\r\n            }\r\n            this.socket.log('channel', `error ${this.topic}`, reason);\r\n            this.state = constants_1.CHANNEL_STATES.errored;\r\n            this.rejoinTimer.scheduleTimeout();\r\n        });\r\n        this._on(constants_1.CHANNEL_EVENTS.reply, {}, (payload, ref) => {\r\n            this._trigger(this._replyEventName(ref), payload);\r\n        });\r\n        this.presence = new RealtimePresence_1.default(this);\r\n        this.broadcastEndpointURL = (0, transformers_1.httpEndpointURL)(this.socket.endPoint);\r\n        this.private = this.params.config.private || false;\r\n        if (!this.private && ((_b = (_a = this.params.config) === null || _a === void 0 ? void 0 : _a.broadcast) === null || _b === void 0 ? void 0 : _b.replay)) {\r\n            throw `tried to use replay on public channel '${this.topic}'. It must be a private channel.`;\r\n        }\r\n    }\r\n    /** Subscribe registers your client with the server */\r\n    subscribe(callback, timeout = this.timeout) {\r\n        var _a, _b, _c;\r\n        if (!this.socket.isConnected()) {\r\n            this.socket.connect();\r\n        }\r\n        if (this.state == constants_1.CHANNEL_STATES.closed) {\r\n            const { config: { broadcast, presence, private: isPrivate }, } = this.params;\r\n            const postgres_changes = (_b = (_a = this.bindings.postgres_changes) === null || _a === void 0 ? void 0 : _a.map((r) => r.filter)) !== null && _b !== void 0 ? _b : [];\r\n            const presence_enabled = (!!this.bindings[REALTIME_LISTEN_TYPES.PRESENCE] &&\r\n                this.bindings[REALTIME_LISTEN_TYPES.PRESENCE].length > 0) ||\r\n                ((_c = this.params.config.presence) === null || _c === void 0 ? void 0 : _c.enabled) === true;\r\n            const accessTokenPayload = {};\r\n            const config = {\r\n                broadcast,\r\n                presence: Object.assign(Object.assign({}, presence), { enabled: presence_enabled }),\r\n                postgres_changes,\r\n                private: isPrivate,\r\n            };\r\n            if (this.socket.accessTokenValue) {\r\n                accessTokenPayload.access_token = this.socket.accessTokenValue;\r\n            }\r\n            this._onError((e) => callback === null || callback === void 0 ? void 0 : callback(REALTIME_SUBSCRIBE_STATES.CHANNEL_ERROR, e));\r\n            this._onClose(() => callback === null || callback === void 0 ? void 0 : callback(REALTIME_SUBSCRIBE_STATES.CLOSED));\r\n            this.updateJoinPayload(Object.assign({ config }, accessTokenPayload));\r\n            this.joinedOnce = true;\r\n            this._rejoin(timeout);\r\n            this.joinPush\r\n                .receive('ok', async ({ postgres_changes }) => {\r\n                var _a;\r\n                // Only refresh auth if using callback-based tokens\r\n                if (!this.socket._isManualToken()) {\r\n                    this.socket.setAuth();\r\n                }\r\n                if (postgres_changes === undefined) {\r\n                    callback === null || callback === void 0 ? void 0 : callback(REALTIME_SUBSCRIBE_STATES.SUBSCRIBED);\r\n                    return;\r\n                }\r\n                else {\r\n                    const clientPostgresBindings = this.bindings.postgres_changes;\r\n                    const bindingsLen = (_a = clientPostgresBindings === null || clientPostgresBindings === void 0 ? void 0 : clientPostgresBindings.length) !== null && _a !== void 0 ? _a : 0;\r\n                    const newPostgresBindings = [];\r\n                    for (let i = 0; i < bindingsLen; i++) {\r\n                        const clientPostgresBinding = clientPostgresBindings[i];\r\n                        const { filter: { event, schema, table, filter }, } = clientPostgresBinding;\r\n                        const serverPostgresFilter = postgres_changes && postgres_changes[i];\r\n                        if (serverPostgresFilter &&\r\n                            serverPostgresFilter.event === event &&\r\n                            RealtimeChannel.isFilterValueEqual(serverPostgresFilter.schema, schema) &&\r\n                            RealtimeChannel.isFilterValueEqual(serverPostgresFilter.table, table) &&\r\n                            RealtimeChannel.isFilterValueEqual(serverPostgresFilter.filter, filter)) {\r\n                            newPostgresBindings.push(Object.assign(Object.assign({}, clientPostgresBinding), { id: serverPostgresFilter.id }));\r\n                        }\r\n                        else {\r\n                            this.unsubscribe();\r\n                            this.state = constants_1.CHANNEL_STATES.errored;\r\n                            callback === null || callback === void 0 ? void 0 : callback(REALTIME_SUBSCRIBE_STATES.CHANNEL_ERROR, new Error('mismatch between server and client bindings for postgres changes'));\r\n                            return;\r\n                        }\r\n                    }\r\n                    this.bindings.postgres_changes = newPostgresBindings;\r\n                    callback && callback(REALTIME_SUBSCRIBE_STATES.SUBSCRIBED);\r\n                    return;\r\n                }\r\n            })\r\n                .receive('error', (error) => {\r\n                this.state = constants_1.CHANNEL_STATES.errored;\r\n                callback === null || callback === void 0 ? void 0 : callback(REALTIME_SUBSCRIBE_STATES.CHANNEL_ERROR, new Error(JSON.stringify(Object.values(error).join(', ') || 'error')));\r\n                return;\r\n            })\r\n                .receive('timeout', () => {\r\n                callback === null || callback === void 0 ? void 0 : callback(REALTIME_SUBSCRIBE_STATES.TIMED_OUT);\r\n                return;\r\n            });\r\n        }\r\n        return this;\r\n    }\r\n    /**\r\n     * Returns the current presence state for this channel.\r\n     *\r\n     * The shape is a map keyed by presence key (for example a user id) where each entry contains the\r\n     * tracked metadata for that user.\r\n     */\r\n    presenceState() {\r\n        return this.presence.state;\r\n    }\r\n    /**\r\n     * Sends the supplied payload to the presence tracker so other subscribers can see that this\r\n     * client is online. Use `untrack` to stop broadcasting presence for the same key.\r\n     */\r\n    async track(payload, opts = {}) {\r\n        return await this.send({\r\n            type: 'presence',\r\n            event: 'track',\r\n            payload,\r\n        }, opts.timeout || this.timeout);\r\n    }\r\n    /**\r\n     * Removes the current presence state for this client.\r\n     */\r\n    async untrack(opts = {}) {\r\n        return await this.send({\r\n            type: 'presence',\r\n            event: 'untrack',\r\n        }, opts);\r\n    }\r\n    on(type, filter, callback) {\r\n        if (this.state === constants_1.CHANNEL_STATES.joined && type === REALTIME_LISTEN_TYPES.PRESENCE) {\r\n            this.socket.log('channel', `resubscribe to ${this.topic} due to change in presence callbacks on joined channel`);\r\n            this.unsubscribe().then(async () => await this.subscribe());\r\n        }\r\n        return this._on(type, filter, callback);\r\n    }\r\n    /**\r\n     * Sends a broadcast message explicitly via REST API.\r\n     *\r\n     * This method always uses the REST API endpoint regardless of WebSocket connection state.\r\n     * Useful when you want to guarantee REST delivery or when gradually migrating from implicit REST fallback.\r\n     *\r\n     * @param event The name of the broadcast event\r\n     * @param payload Payload to be sent (required)\r\n     * @param opts Options including timeout\r\n     * @returns Promise resolving to object with success status, and error details if failed\r\n     */\r\n    async httpSend(event, payload, opts = {}) {\r\n        var _a;\r\n        if (payload === undefined || payload === null) {\r\n            return Promise.reject('Payload is required for httpSend()');\r\n        }\r\n        const headers = {\r\n            apikey: this.socket.apiKey ? this.socket.apiKey : '',\r\n            'Content-Type': 'application/json',\r\n        };\r\n        if (this.socket.accessTokenValue) {\r\n            headers['Authorization'] = `Bearer ${this.socket.accessTokenValue}`;\r\n        }\r\n        const options = {\r\n            method: 'POST',\r\n            headers,\r\n            body: JSON.stringify({\r\n                messages: [\r\n                    {\r\n                        topic: this.subTopic,\r\n                        event,\r\n                        payload: payload,\r\n                        private: this.private,\r\n                    },\r\n                ],\r\n            }),\r\n        };\r\n        const response = await this._fetchWithTimeout(this.broadcastEndpointURL, options, (_a = opts.timeout) !== null && _a !== void 0 ? _a : this.timeout);\r\n        if (response.status === 202) {\r\n            return { success: true };\r\n        }\r\n        let errorMessage = response.statusText;\r\n        try {\r\n            const errorBody = await response.json();\r\n            errorMessage = errorBody.error || errorBody.message || errorMessage;\r\n        }\r\n        catch (_b) { }\r\n        return Promise.reject(new Error(errorMessage));\r\n    }\r\n    /**\r\n     * Sends a message into the channel.\r\n     *\r\n     * @param args Arguments to send to channel\r\n     * @param args.type The type of event to send\r\n     * @param args.event The name of the event being sent\r\n     * @param args.payload Payload to be sent\r\n     * @param opts Options to be used during the send process\r\n     */\r\n    async send(args, opts = {}) {\r\n        var _a, _b;\r\n        if (!this._canPush() && args.type === 'broadcast') {\r\n            console.warn('Realtime send() is automatically falling back to REST API. ' +\r\n                'This behavior will be deprecated in the future. ' +\r\n                'Please use httpSend() explicitly for REST delivery.');\r\n            const { event, payload: endpoint_payload } = args;\r\n            const headers = {\r\n                apikey: this.socket.apiKey ? this.socket.apiKey : '',\r\n                'Content-Type': 'application/json',\r\n            };\r\n            if (this.socket.accessTokenValue) {\r\n                headers['Authorization'] = `Bearer ${this.socket.accessTokenValue}`;\r\n            }\r\n            const options = {\r\n                method: 'POST',\r\n                headers,\r\n                body: JSON.stringify({\r\n                    messages: [\r\n                        {\r\n                            topic: this.subTopic,\r\n                            event,\r\n                            payload: endpoint_payload,\r\n                            private: this.private,\r\n                        },\r\n                    ],\r\n                }),\r\n            };\r\n            try {\r\n                const response = await this._fetchWithTimeout(this.broadcastEndpointURL, options, (_a = opts.timeout) !== null && _a !== void 0 ? _a : this.timeout);\r\n                await ((_b = response.body) === null || _b === void 0 ? void 0 : _b.cancel());\r\n                return response.ok ? 'ok' : 'error';\r\n            }\r\n            catch (error) {\r\n                if (error.name === 'AbortError') {\r\n                    return 'timed out';\r\n                }\r\n                else {\r\n                    return 'error';\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            return new Promise((resolve) => {\r\n                var _a, _b, _c;\r\n                const push = this._push(args.type, args, opts.timeout || this.timeout);\r\n                if (args.type === 'broadcast' && !((_c = (_b = (_a = this.params) === null || _a === void 0 ? void 0 : _a.config) === null || _b === void 0 ? void 0 : _b.broadcast) === null || _c === void 0 ? void 0 : _c.ack)) {\r\n                    resolve('ok');\r\n                }\r\n                push.receive('ok', () => resolve('ok'));\r\n                push.receive('error', () => resolve('error'));\r\n                push.receive('timeout', () => resolve('timed out'));\r\n            });\r\n        }\r\n    }\r\n    /**\r\n     * Updates the payload that will be sent the next time the channel joins (reconnects).\r\n     * Useful for rotating access tokens or updating config without re-creating the channel.\r\n     */\r\n    updateJoinPayload(payload) {\r\n        this.joinPush.updatePayload(payload);\r\n    }\r\n    /**\r\n     * Leaves the channel.\r\n     *\r\n     * Unsubscribes from server events, and instructs channel to terminate on server.\r\n     * Triggers onClose() hooks.\r\n     *\r\n     * To receive leave acknowledgements, use the a `receive` hook to bind to the server ack, ie:\r\n     * channel.unsubscribe().receive(\"ok\", () => alert(\"left!\") )\r\n     */\r\n    unsubscribe(timeout = this.timeout) {\r\n        this.state = constants_1.CHANNEL_STATES.leaving;\r\n        const onClose = () => {\r\n            this.socket.log('channel', `leave ${this.topic}`);\r\n            this._trigger(constants_1.CHANNEL_EVENTS.close, 'leave', this._joinRef());\r\n        };\r\n        this.joinPush.destroy();\r\n        let leavePush = null;\r\n        return new Promise((resolve) => {\r\n            leavePush = new push_1.default(this, constants_1.CHANNEL_EVENTS.leave, {}, timeout);\r\n            leavePush\r\n                .receive('ok', () => {\r\n                onClose();\r\n                resolve('ok');\r\n            })\r\n                .receive('timeout', () => {\r\n                onClose();\r\n                resolve('timed out');\r\n            })\r\n                .receive('error', () => {\r\n                resolve('error');\r\n            });\r\n            leavePush.send();\r\n            if (!this._canPush()) {\r\n                leavePush.trigger('ok', {});\r\n            }\r\n        }).finally(() => {\r\n            leavePush === null || leavePush === void 0 ? void 0 : leavePush.destroy();\r\n        });\r\n    }\r\n    /**\r\n     * Teardown the channel.\r\n     *\r\n     * Destroys and stops related timers.\r\n     */\r\n    teardown() {\r\n        this.pushBuffer.forEach((push) => push.destroy());\r\n        this.pushBuffer = [];\r\n        this.rejoinTimer.reset();\r\n        this.joinPush.destroy();\r\n        this.state = constants_1.CHANNEL_STATES.closed;\r\n        this.bindings = {};\r\n    }\r\n    /** @internal */\r\n    async _fetchWithTimeout(url, options, timeout) {\r\n        const controller = new AbortController();\r\n        const id = setTimeout(() => controller.abort(), timeout);\r\n        const response = await this.socket.fetch(url, Object.assign(Object.assign({}, options), { signal: controller.signal }));\r\n        clearTimeout(id);\r\n        return response;\r\n    }\r\n    /** @internal */\r\n    _push(event, payload, timeout = this.timeout) {\r\n        if (!this.joinedOnce) {\r\n            throw `tried to push '${event}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;\r\n        }\r\n        let pushEvent = new push_1.default(this, event, payload, timeout);\r\n        if (this._canPush()) {\r\n            pushEvent.send();\r\n        }\r\n        else {\r\n            this._addToPushBuffer(pushEvent);\r\n        }\r\n        return pushEvent;\r\n    }\r\n    /** @internal */\r\n    _addToPushBuffer(pushEvent) {\r\n        pushEvent.startTimeout();\r\n        this.pushBuffer.push(pushEvent);\r\n        // Enforce buffer size limit\r\n        if (this.pushBuffer.length > constants_1.MAX_PUSH_BUFFER_SIZE) {\r\n            const removedPush = this.pushBuffer.shift();\r\n            if (removedPush) {\r\n                removedPush.destroy();\r\n                this.socket.log('channel', `discarded push due to buffer overflow: ${removedPush.event}`, removedPush.payload);\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * Overridable message hook\r\n     *\r\n     * Receives all events for specialized message handling before dispatching to the channel callbacks.\r\n     * Must return the payload, modified or unmodified.\r\n     *\r\n     * @internal\r\n     */\r\n    _onMessage(_event, payload, _ref) {\r\n        return payload;\r\n    }\r\n    /** @internal */\r\n    _isMember(topic) {\r\n        return this.topic === topic;\r\n    }\r\n    /** @internal */\r\n    _joinRef() {\r\n        return this.joinPush.ref;\r\n    }\r\n    /** @internal */\r\n    _trigger(type, payload, ref) {\r\n        var _a, _b;\r\n        const typeLower = type.toLocaleLowerCase();\r\n        const { close, error, leave, join } = constants_1.CHANNEL_EVENTS;\r\n        const events = [close, error, leave, join];\r\n        if (ref && events.indexOf(typeLower) >= 0 && ref !== this._joinRef()) {\r\n            return;\r\n        }\r\n        let handledPayload = this._onMessage(typeLower, payload, ref);\r\n        if (payload && !handledPayload) {\r\n            throw 'channel onMessage callbacks must return the payload, modified or unmodified';\r\n        }\r\n        if (['insert', 'update', 'delete'].includes(typeLower)) {\r\n            (_a = this.bindings.postgres_changes) === null || _a === void 0 ? void 0 : _a.filter((bind) => {\r\n                var _a, _b, _c;\r\n                return ((_a = bind.filter) === null || _a === void 0 ? void 0 : _a.event) === '*' || ((_c = (_b = bind.filter) === null || _b === void 0 ? void 0 : _b.event) === null || _c === void 0 ? void 0 : _c.toLocaleLowerCase()) === typeLower;\r\n            }).map((bind) => bind.callback(handledPayload, ref));\r\n        }\r\n        else {\r\n            (_b = this.bindings[typeLower]) === null || _b === void 0 ? void 0 : _b.filter((bind) => {\r\n                var _a, _b, _c, _d, _e, _f;\r\n                if (['broadcast', 'presence', 'postgres_changes'].includes(typeLower)) {\r\n                    if ('id' in bind) {\r\n                        const bindId = bind.id;\r\n                        const bindEvent = (_a = bind.filter) === null || _a === void 0 ? void 0 : _a.event;\r\n                        return (bindId &&\r\n                            ((_b = payload.ids) === null || _b === void 0 ? void 0 : _b.includes(bindId)) &&\r\n                            (bindEvent === '*' ||\r\n                                (bindEvent === null || bindEvent === void 0 ? void 0 : bindEvent.toLocaleLowerCase()) === ((_c = payload.data) === null || _c === void 0 ? void 0 : _c.type.toLocaleLowerCase())));\r\n                    }\r\n                    else {\r\n                        const bindEvent = (_e = (_d = bind === null || bind === void 0 ? void 0 : bind.filter) === null || _d === void 0 ? void 0 : _d.event) === null || _e === void 0 ? void 0 : _e.toLocaleLowerCase();\r\n                        return bindEvent === '*' || bindEvent === ((_f = payload === null || payload === void 0 ? void 0 : payload.event) === null || _f === void 0 ? void 0 : _f.toLocaleLowerCase());\r\n                    }\r\n                }\r\n                else {\r\n                    return bind.type.toLocaleLowerCase() === typeLower;\r\n                }\r\n            }).map((bind) => {\r\n                if (typeof handledPayload === 'object' && 'ids' in handledPayload) {\r\n                    const postgresChanges = handledPayload.data;\r\n                    const { schema, table, commit_timestamp, type, errors } = postgresChanges;\r\n                    const enrichedPayload = {\r\n                        schema: schema,\r\n                        table: table,\r\n                        commit_timestamp: commit_timestamp,\r\n                        eventType: type,\r\n                        new: {},\r\n                        old: {},\r\n                        errors: errors,\r\n                    };\r\n                    handledPayload = Object.assign(Object.assign({}, enrichedPayload), this._getPayloadRecords(postgresChanges));\r\n                }\r\n                bind.callback(handledPayload, ref);\r\n            });\r\n        }\r\n    }\r\n    /** @internal */\r\n    _isClosed() {\r\n        return this.state === constants_1.CHANNEL_STATES.closed;\r\n    }\r\n    /** @internal */\r\n    _isJoined() {\r\n        return this.state === constants_1.CHANNEL_STATES.joined;\r\n    }\r\n    /** @internal */\r\n    _isJoining() {\r\n        return this.state === constants_1.CHANNEL_STATES.joining;\r\n    }\r\n    /** @internal */\r\n    _isLeaving() {\r\n        return this.state === constants_1.CHANNEL_STATES.leaving;\r\n    }\r\n    /** @internal */\r\n    _replyEventName(ref) {\r\n        return `chan_reply_${ref}`;\r\n    }\r\n    /** @internal */\r\n    _on(type, filter, callback) {\r\n        const typeLower = type.toLocaleLowerCase();\r\n        const binding = {\r\n            type: typeLower,\r\n            filter: filter,\r\n            callback: callback,\r\n        };\r\n        if (this.bindings[typeLower]) {\r\n            this.bindings[typeLower].push(binding);\r\n        }\r\n        else {\r\n            this.bindings[typeLower] = [binding];\r\n        }\r\n        return this;\r\n    }\r\n    /** @internal */\r\n    _off(type, filter) {\r\n        const typeLower = type.toLocaleLowerCase();\r\n        if (this.bindings[typeLower]) {\r\n            this.bindings[typeLower] = this.bindings[typeLower].filter((bind) => {\r\n                var _a;\r\n                return !(((_a = bind.type) === null || _a === void 0 ? void 0 : _a.toLocaleLowerCase()) === typeLower &&\r\n                    RealtimeChannel.isEqual(bind.filter, filter));\r\n            });\r\n        }\r\n        return this;\r\n    }\r\n    /** @internal */\r\n    static isEqual(obj1, obj2) {\r\n        if (Object.keys(obj1).length !== Object.keys(obj2).length) {\r\n            return false;\r\n        }\r\n        for (const k in obj1) {\r\n            if (obj1[k] !== obj2[k]) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n    /**\r\n     * Compares two optional filter values for equality.\r\n     * Treats undefined, null, and empty string as equivalent empty values.\r\n     * @internal\r\n     */\r\n    static isFilterValueEqual(serverValue, clientValue) {\r\n        const normalizedServer = serverValue !== null && serverValue !== void 0 ? serverValue : undefined;\r\n        const normalizedClient = clientValue !== null && clientValue !== void 0 ? clientValue : undefined;\r\n        return normalizedServer === normalizedClient;\r\n    }\r\n    /** @internal */\r\n    _rejoinUntilConnected() {\r\n        this.rejoinTimer.scheduleTimeout();\r\n        if (this.socket.isConnected()) {\r\n            this._rejoin();\r\n        }\r\n    }\r\n    /**\r\n     * Registers a callback that will be executed when the channel closes.\r\n     *\r\n     * @internal\r\n     */\r\n    _onClose(callback) {\r\n        this._on(constants_1.CHANNEL_EVENTS.close, {}, callback);\r\n    }\r\n    /**\r\n     * Registers a callback that will be executed when the channel encounteres an error.\r\n     *\r\n     * @internal\r\n     */\r\n    _onError(callback) {\r\n        this._on(constants_1.CHANNEL_EVENTS.error, {}, (reason) => callback(reason));\r\n    }\r\n    /**\r\n     * Returns `true` if the socket is connected and the channel has been joined.\r\n     *\r\n     * @internal\r\n     */\r\n    _canPush() {\r\n        return this.socket.isConnected() && this._isJoined();\r\n    }\r\n    /** @internal */\r\n    _rejoin(timeout = this.timeout) {\r\n        if (this._isLeaving()) {\r\n            return;\r\n        }\r\n        this.socket._leaveOpenTopic(this.topic);\r\n        this.state = constants_1.CHANNEL_STATES.joining;\r\n        this.joinPush.resend(timeout);\r\n    }\r\n    /** @internal */\r\n    _getPayloadRecords(payload) {\r\n        const records = {\r\n            new: {},\r\n            old: {},\r\n        };\r\n        if (payload.type === 'INSERT' || payload.type === 'UPDATE') {\r\n            records.new = Transformers.convertChangeData(payload.columns, payload.record);\r\n        }\r\n        if (payload.type === 'UPDATE' || payload.type === 'DELETE') {\r\n            records.old = Transformers.convertChangeData(payload.columns, payload.old_record);\r\n        }\r\n        return records;\r\n    }\r\n}\r\nexports.default = RealtimeChannel;\r\n//# sourceMappingURL=RealtimeChannel.js.map\n};"],
"names":["shadow$provide","require","module","exports","Object","defineProperty","value","REALTIME_CHANNEL_STATES","REALTIME_SUBSCRIBE_STATES","REALTIME_LISTEN_TYPES","REALTIME_POSTGRES_CHANGES_LISTEN_EVENT","tslib_1","constants_1","push_1","__importDefault","timer_1","RealtimePresence_1","Transformers","__importStar","transformers_1","CHANNEL_STATES","RealtimeChannel","constructor","topic","params","config","socket","_a","_b","bindings","state","closed","joinedOnce","pushBuffer","subTopic","replace","assign","broadcast","ack","self","presence","key","enabled","private","timeout","joinPush","default","CHANNEL_EVENTS","join","rejoinTimer","_rejoinUntilConnected","reconnectAfterMs","receive","joined","reset","forEach","pushEvent","send","_onClose","log","_joinRef","_remove","_onError","reason","_isLeaving","_isClosed","errored","scheduleTimeout","_isJoining","_on","reply","payload","ref","_trigger","_replyEventName","broadcastEndpointURL","httpEndpointURL","endPoint","replay","subscribe","callback","_c","isConnected","connect","isPrivate","postgres_changes","map","r","filter","presence_enabled","PRESENCE","length","accessTokenPayload","accessTokenValue","access_token","e","CHANNEL_ERROR","CLOSED","updateJoinPayload","_rejoin","_isManualToken","setAuth","undefined","SUBSCRIBED","clientPostgresBindings","bindingsLen","newPostgresBindings","i","clientPostgresBinding","event","schema","table","serverPostgresFilter","isFilterValueEqual","push","id","unsubscribe","Error","error","JSON","stringify","values","TIMED_OUT","presenceState","track","opts","type","untrack","on","then","httpSend","Promise","reject","headers","apikey","apiKey","options","method","body","messages","response","_fetchWithTimeout","status","success","errorMessage","statusText","errorBody","json","message","args","_canPush","resolve","_push","console","warn","endpoint_payload","cancel","ok","name","updatePayload","leaving","onClose","close","destroy","leavePush","finally","leave","trigger","teardown","url","controller","AbortController","setTimeout","abort","fetch","signal","clearTimeout","_addToPushBuffer","startTimeout","MAX_PUSH_BUFFER_SIZE","removedPush","shift","_onMessage","_event","_ref","_isMember","typeLower","toLocaleLowerCase","events","indexOf","handledPayload","includes","bind","_e","_f","bindId","bindEvent","ids","data","_d","postgresChanges","commit_timestamp","errors","enrichedPayload","eventType","new","old","_getPayloadRecords","_isJoined","joining","binding","_off","isEqual","obj1","obj2","keys","k","serverValue","clientValue","normalizedServer","normalizedClient","_leaveOpenTopic","resend","records","convertChangeData","columns","record","old_record"]
}
