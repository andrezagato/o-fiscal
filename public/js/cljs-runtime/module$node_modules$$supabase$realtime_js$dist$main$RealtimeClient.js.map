{
"version":3,
"file":"module$node_modules$$supabase$realtime_js$dist$main$RealtimeClient.js",
"lineCount":416,
"mappings":"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",
"sources":["node_modules/@supabase/realtime-js/dist/main/RealtimeClient.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$$supabase$realtime_js$dist$main$RealtimeClient\"] = function(require,module,exports) {\n\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst tslib_1 = require(\"tslib\");\r\nconst websocket_factory_1 = tslib_1.__importDefault(require(\"./lib/websocket-factory\"));\r\nconst constants_1 = require(\"./lib/constants\");\r\nconst serializer_1 = tslib_1.__importDefault(require(\"./lib/serializer\"));\r\nconst timer_1 = tslib_1.__importDefault(require(\"./lib/timer\"));\r\nconst transformers_1 = require(\"./lib/transformers\");\r\nconst RealtimeChannel_1 = tslib_1.__importDefault(require(\"./RealtimeChannel\"));\r\nconst noop = () => { };\r\n// Connection-related constants\r\nconst CONNECTION_TIMEOUTS = {\r\n    HEARTBEAT_INTERVAL: 25000,\r\n    RECONNECT_DELAY: 10,\r\n    HEARTBEAT_TIMEOUT_FALLBACK: 100,\r\n};\r\nconst RECONNECT_INTERVALS = [1000, 2000, 5000, 10000];\r\nconst DEFAULT_RECONNECT_FALLBACK = 10000;\r\nconst WORKER_SCRIPT = `\r\n  addEventListener(\"message\", (e) => {\r\n    if (e.data.event === \"start\") {\r\n      setInterval(() => postMessage({ event: \"keepAlive\" }), e.data.interval);\r\n    }\r\n  });`;\r\nclass RealtimeClient {\r\n    /**\r\n     * Initializes the Socket.\r\n     *\r\n     * @param endPoint The string WebSocket endpoint, ie, \"ws://example.com/socket\", \"wss://example.com\", \"/socket\" (inherited host & protocol)\r\n     * @param httpEndpoint The string HTTP endpoint, ie, \"https://example.com\", \"/\" (inherited host & protocol)\r\n     * @param options.transport The Websocket Transport, for example WebSocket. This can be a custom implementation\r\n     * @param options.timeout The default timeout in milliseconds to trigger push timeouts.\r\n     * @param options.params The optional params to pass when connecting.\r\n     * @param options.headers Deprecated: headers cannot be set on websocket connections and this option will be removed in the future.\r\n     * @param options.heartbeatIntervalMs The millisec interval to send a heartbeat message.\r\n     * @param options.heartbeatCallback The optional function to handle heartbeat status and latency.\r\n     * @param options.logger The optional function for specialized logging, ie: logger: (kind, msg, data) => { console.log(`${kind}: ${msg}`, data) }\r\n     * @param options.logLevel Sets the log level for Realtime\r\n     * @param options.encode The function to encode outgoing messages. Defaults to JSON: (payload, callback) => callback(JSON.stringify(payload))\r\n     * @param options.decode The function to decode incoming messages. Defaults to Serializer's decode.\r\n     * @param options.reconnectAfterMs he optional function that returns the millsec reconnect interval. Defaults to stepped backoff off.\r\n     * @param options.worker Use Web Worker to set a side flow. Defaults to false.\r\n     * @param options.workerUrl The URL of the worker script. Defaults to https://realtime.supabase.com/worker.js that includes a heartbeat event call to keep the connection alive.\r\n     * @param options.vsn The protocol version to use when connecting. Supported versions are \"1.0.0\" and \"2.0.0\". Defaults to \"2.0.0\".\r\n     * @example\r\n     * ```ts\r\n     * import RealtimeClient from '@supabase/realtime-js'\r\n     *\r\n     * const client = new RealtimeClient('https://xyzcompany.supabase.co/realtime/v1', {\r\n     *   params: { apikey: 'public-anon-key' },\r\n     * })\r\n     * client.connect()\r\n     * ```\r\n     */\r\n    constructor(endPoint, options) {\r\n        var _a;\r\n        this.accessTokenValue = null;\r\n        this.apiKey = null;\r\n        this._manuallySetToken = false;\r\n        this.channels = new Array();\r\n        this.endPoint = '';\r\n        this.httpEndpoint = '';\r\n        /** @deprecated headers cannot be set on websocket connections */\r\n        this.headers = {};\r\n        this.params = {};\r\n        this.timeout = constants_1.DEFAULT_TIMEOUT;\r\n        this.transport = null;\r\n        this.heartbeatIntervalMs = CONNECTION_TIMEOUTS.HEARTBEAT_INTERVAL;\r\n        this.heartbeatTimer = undefined;\r\n        this.pendingHeartbeatRef = null;\r\n        this.heartbeatCallback = noop;\r\n        this.ref = 0;\r\n        this.reconnectTimer = null;\r\n        this.vsn = constants_1.DEFAULT_VSN;\r\n        this.logger = noop;\r\n        this.conn = null;\r\n        this.sendBuffer = [];\r\n        this.serializer = new serializer_1.default();\r\n        this.stateChangeCallbacks = {\r\n            open: [],\r\n            close: [],\r\n            error: [],\r\n            message: [],\r\n        };\r\n        this.accessToken = null;\r\n        this._connectionState = 'disconnected';\r\n        this._wasManualDisconnect = false;\r\n        this._authPromise = null;\r\n        this._heartbeatSentAt = null;\r\n        /**\r\n         * Use either custom fetch, if provided, or default fetch to make HTTP requests\r\n         *\r\n         * @internal\r\n         */\r\n        this._resolveFetch = (customFetch) => {\r\n            if (customFetch) {\r\n                return (...args) => customFetch(...args);\r\n            }\r\n            return (...args) => fetch(...args);\r\n        };\r\n        // Validate required parameters\r\n        if (!((_a = options === null || options === void 0 ? void 0 : options.params) === null || _a === void 0 ? void 0 : _a.apikey)) {\r\n            throw new Error('API key is required to connect to Realtime');\r\n        }\r\n        this.apiKey = options.params.apikey;\r\n        // Initialize endpoint URLs\r\n        this.endPoint = `${endPoint}/${constants_1.TRANSPORTS.websocket}`;\r\n        this.httpEndpoint = (0, transformers_1.httpEndpointURL)(endPoint);\r\n        this._initializeOptions(options);\r\n        this._setupReconnectionTimer();\r\n        this.fetch = this._resolveFetch(options === null || options === void 0 ? void 0 : options.fetch);\r\n    }\r\n    /**\r\n     * Connects the socket, unless already connected.\r\n     */\r\n    connect() {\r\n        // Skip if already connecting, disconnecting, or connected\r\n        if (this.isConnecting() ||\r\n            this.isDisconnecting() ||\r\n            (this.conn !== null && this.isConnected())) {\r\n            return;\r\n        }\r\n        this._setConnectionState('connecting');\r\n        // Trigger auth if needed and not already in progress\r\n        // This ensures auth is called for standalone RealtimeClient usage\r\n        // while avoiding race conditions with SupabaseClient's immediate setAuth call\r\n        if (this.accessToken && !this._authPromise) {\r\n            this._setAuthSafely('connect');\r\n        }\r\n        // Establish WebSocket connection\r\n        if (this.transport) {\r\n            // Use custom transport if provided\r\n            this.conn = new this.transport(this.endpointURL());\r\n        }\r\n        else {\r\n            // Try to use native WebSocket\r\n            try {\r\n                this.conn = websocket_factory_1.default.createWebSocket(this.endpointURL());\r\n            }\r\n            catch (error) {\r\n                this._setConnectionState('disconnected');\r\n                const errorMessage = error.message;\r\n                // Provide helpful error message based on environment\r\n                if (errorMessage.includes('Node.js')) {\r\n                    throw new Error(`${errorMessage}\\n\\n` +\r\n                        'To use Realtime in Node.js, you need to provide a WebSocket implementation:\\n\\n' +\r\n                        'Option 1: Use Node.js 22+ which has native WebSocket support\\n' +\r\n                        'Option 2: Install and provide the \"ws\" package:\\n\\n' +\r\n                        '  npm install ws\\n\\n' +\r\n                        '  import ws from \"ws\"\\n' +\r\n                        '  const client = new RealtimeClient(url, {\\n' +\r\n                        '    ...options,\\n' +\r\n                        '    transport: ws\\n' +\r\n                        '  })');\r\n                }\r\n                throw new Error(`WebSocket not available: ${errorMessage}`);\r\n            }\r\n        }\r\n        this._setupConnectionHandlers();\r\n    }\r\n    /**\r\n     * Returns the URL of the websocket.\r\n     * @returns string The URL of the websocket.\r\n     */\r\n    endpointURL() {\r\n        return this._appendParams(this.endPoint, Object.assign({}, this.params, { vsn: this.vsn }));\r\n    }\r\n    /**\r\n     * Disconnects the socket.\r\n     *\r\n     * @param code A numeric status code to send on disconnect.\r\n     * @param reason A custom reason for the disconnect.\r\n     */\r\n    disconnect(code, reason) {\r\n        if (this.isDisconnecting()) {\r\n            return;\r\n        }\r\n        this._setConnectionState('disconnecting', true);\r\n        if (this.conn) {\r\n            // Setup fallback timer to prevent hanging in disconnecting state\r\n            const fallbackTimer = setTimeout(() => {\r\n                this._setConnectionState('disconnected');\r\n            }, 100);\r\n            this.conn.onclose = () => {\r\n                clearTimeout(fallbackTimer);\r\n                this._setConnectionState('disconnected');\r\n            };\r\n            // Close the WebSocket connection if close method exists\r\n            if (typeof this.conn.close === 'function') {\r\n                if (code) {\r\n                    this.conn.close(code, reason !== null && reason !== void 0 ? reason : '');\r\n                }\r\n                else {\r\n                    this.conn.close();\r\n                }\r\n            }\r\n            this._teardownConnection();\r\n        }\r\n        else {\r\n            this._setConnectionState('disconnected');\r\n        }\r\n    }\r\n    /**\r\n     * Returns all created channels\r\n     */\r\n    getChannels() {\r\n        return this.channels;\r\n    }\r\n    /**\r\n     * Unsubscribes and removes a single channel\r\n     * @param channel A RealtimeChannel instance\r\n     */\r\n    async removeChannel(channel) {\r\n        const status = await channel.unsubscribe();\r\n        if (this.channels.length === 0) {\r\n            this.disconnect();\r\n        }\r\n        return status;\r\n    }\r\n    /**\r\n     * Unsubscribes and removes all channels\r\n     */\r\n    async removeAllChannels() {\r\n        const values_1 = await Promise.all(this.channels.map((channel) => channel.unsubscribe()));\r\n        this.channels = [];\r\n        this.disconnect();\r\n        return values_1;\r\n    }\r\n    /**\r\n     * Logs the message.\r\n     *\r\n     * For customized logging, `this.logger` can be overridden.\r\n     */\r\n    log(kind, msg, data) {\r\n        this.logger(kind, msg, data);\r\n    }\r\n    /**\r\n     * Returns the current state of the socket.\r\n     */\r\n    connectionState() {\r\n        switch (this.conn && this.conn.readyState) {\r\n            case constants_1.SOCKET_STATES.connecting:\r\n                return constants_1.CONNECTION_STATE.Connecting;\r\n            case constants_1.SOCKET_STATES.open:\r\n                return constants_1.CONNECTION_STATE.Open;\r\n            case constants_1.SOCKET_STATES.closing:\r\n                return constants_1.CONNECTION_STATE.Closing;\r\n            default:\r\n                return constants_1.CONNECTION_STATE.Closed;\r\n        }\r\n    }\r\n    /**\r\n     * Returns `true` is the connection is open.\r\n     */\r\n    isConnected() {\r\n        return this.connectionState() === constants_1.CONNECTION_STATE.Open;\r\n    }\r\n    /**\r\n     * Returns `true` if the connection is currently connecting.\r\n     */\r\n    isConnecting() {\r\n        return this._connectionState === 'connecting';\r\n    }\r\n    /**\r\n     * Returns `true` if the connection is currently disconnecting.\r\n     */\r\n    isDisconnecting() {\r\n        return this._connectionState === 'disconnecting';\r\n    }\r\n    /**\r\n     * Creates (or reuses) a {@link RealtimeChannel} for the provided topic.\r\n     *\r\n     * Topics are automatically prefixed with `realtime:` to match the Realtime service.\r\n     * If a channel with the same topic already exists it will be returned instead of creating\r\n     * a duplicate connection.\r\n     */\r\n    channel(topic, params = { config: {} }) {\r\n        const realtimeTopic = `realtime:${topic}`;\r\n        const exists = this.getChannels().find((c) => c.topic === realtimeTopic);\r\n        if (!exists) {\r\n            const chan = new RealtimeChannel_1.default(`realtime:${topic}`, params, this);\r\n            this.channels.push(chan);\r\n            return chan;\r\n        }\r\n        else {\r\n            return exists;\r\n        }\r\n    }\r\n    /**\r\n     * Push out a message if the socket is connected.\r\n     *\r\n     * If the socket is not connected, the message gets enqueued within a local buffer, and sent out when a connection is next established.\r\n     */\r\n    push(data) {\r\n        const { topic, event, payload, ref } = data;\r\n        const callback = () => {\r\n            this.encode(data, (result) => {\r\n                var _a;\r\n                (_a = this.conn) === null || _a === void 0 ? void 0 : _a.send(result);\r\n            });\r\n        };\r\n        this.log('push', `${topic} ${event} (${ref})`, payload);\r\n        if (this.isConnected()) {\r\n            callback();\r\n        }\r\n        else {\r\n            this.sendBuffer.push(callback);\r\n        }\r\n    }\r\n    /**\r\n     * Sets the JWT access token used for channel subscription authorization and Realtime RLS.\r\n     *\r\n     * If param is null it will use the `accessToken` callback function or the token set on the client.\r\n     *\r\n     * On callback used, it will set the value of the token internal to the client.\r\n     *\r\n     * When a token is explicitly provided, it will be preserved across channel operations\r\n     * (including removeChannel and resubscribe). The `accessToken` callback will not be\r\n     * invoked until `setAuth()` is called without arguments.\r\n     *\r\n     * @param token A JWT string to override the token set on the client.\r\n     *\r\n     * @example\r\n     * // Use a manual token (preserved across resubscribes, ignores accessToken callback)\r\n     * client.realtime.setAuth('my-custom-jwt')\r\n     *\r\n     * // Switch back to using the accessToken callback\r\n     * client.realtime.setAuth()\r\n     */\r\n    async setAuth(token = null) {\r\n        this._authPromise = this._performAuth(token);\r\n        try {\r\n            await this._authPromise;\r\n        }\r\n        finally {\r\n            this._authPromise = null;\r\n        }\r\n    }\r\n    /**\r\n     * Returns true if the current access token was explicitly set via setAuth(token),\r\n     * false if it was obtained via the accessToken callback.\r\n     * @internal\r\n     */\r\n    _isManualToken() {\r\n        return this._manuallySetToken;\r\n    }\r\n    /**\r\n     * Sends a heartbeat message if the socket is connected.\r\n     */\r\n    async sendHeartbeat() {\r\n        var _a;\r\n        if (!this.isConnected()) {\r\n            try {\r\n                this.heartbeatCallback('disconnected');\r\n            }\r\n            catch (e) {\r\n                this.log('error', 'error in heartbeat callback', e);\r\n            }\r\n            return;\r\n        }\r\n        // Handle heartbeat timeout and force reconnection if needed\r\n        if (this.pendingHeartbeatRef) {\r\n            this.pendingHeartbeatRef = null;\r\n            this._heartbeatSentAt = null;\r\n            this.log('transport', 'heartbeat timeout. Attempting to re-establish connection');\r\n            try {\r\n                this.heartbeatCallback('timeout');\r\n            }\r\n            catch (e) {\r\n                this.log('error', 'error in heartbeat callback', e);\r\n            }\r\n            // Force reconnection after heartbeat timeout\r\n            this._wasManualDisconnect = false;\r\n            (_a = this.conn) === null || _a === void 0 ? void 0 : _a.close(constants_1.WS_CLOSE_NORMAL, 'heartbeat timeout');\r\n            setTimeout(() => {\r\n                var _a;\r\n                if (!this.isConnected()) {\r\n                    (_a = this.reconnectTimer) === null || _a === void 0 ? void 0 : _a.scheduleTimeout();\r\n                }\r\n            }, CONNECTION_TIMEOUTS.HEARTBEAT_TIMEOUT_FALLBACK);\r\n            return;\r\n        }\r\n        // Send heartbeat message to server\r\n        this._heartbeatSentAt = Date.now();\r\n        this.pendingHeartbeatRef = this._makeRef();\r\n        this.push({\r\n            topic: 'phoenix',\r\n            event: 'heartbeat',\r\n            payload: {},\r\n            ref: this.pendingHeartbeatRef,\r\n        });\r\n        try {\r\n            this.heartbeatCallback('sent');\r\n        }\r\n        catch (e) {\r\n            this.log('error', 'error in heartbeat callback', e);\r\n        }\r\n        this._setAuthSafely('heartbeat');\r\n    }\r\n    /**\r\n     * Sets a callback that receives lifecycle events for internal heartbeat messages.\r\n     * Useful for instrumenting connection health (e.g. sent/ok/timeout/disconnected).\r\n     */\r\n    onHeartbeat(callback) {\r\n        this.heartbeatCallback = callback;\r\n    }\r\n    /**\r\n     * Flushes send buffer\r\n     */\r\n    flushSendBuffer() {\r\n        if (this.isConnected() && this.sendBuffer.length > 0) {\r\n            this.sendBuffer.forEach((callback) => callback());\r\n            this.sendBuffer = [];\r\n        }\r\n    }\r\n    /**\r\n     * Return the next message ref, accounting for overflows\r\n     *\r\n     * @internal\r\n     */\r\n    _makeRef() {\r\n        let newRef = this.ref + 1;\r\n        if (newRef === this.ref) {\r\n            this.ref = 0;\r\n        }\r\n        else {\r\n            this.ref = newRef;\r\n        }\r\n        return this.ref.toString();\r\n    }\r\n    /**\r\n     * Unsubscribe from channels with the specified topic.\r\n     *\r\n     * @internal\r\n     */\r\n    _leaveOpenTopic(topic) {\r\n        let dupChannel = this.channels.find((c) => c.topic === topic && (c._isJoined() || c._isJoining()));\r\n        if (dupChannel) {\r\n            this.log('transport', `leaving duplicate topic \"${topic}\"`);\r\n            dupChannel.unsubscribe();\r\n        }\r\n    }\r\n    /**\r\n     * Removes a subscription from the socket.\r\n     *\r\n     * @param channel An open subscription.\r\n     *\r\n     * @internal\r\n     */\r\n    _remove(channel) {\r\n        this.channels = this.channels.filter((c) => c.topic !== channel.topic);\r\n    }\r\n    /** @internal */\r\n    _onConnMessage(rawMessage) {\r\n        this.decode(rawMessage.data, (msg) => {\r\n            // Handle heartbeat responses\r\n            if (msg.topic === 'phoenix' &&\r\n                msg.event === 'phx_reply' &&\r\n                msg.ref &&\r\n                msg.ref === this.pendingHeartbeatRef) {\r\n                const latency = this._heartbeatSentAt ? Date.now() - this._heartbeatSentAt : undefined;\r\n                try {\r\n                    this.heartbeatCallback(msg.payload.status === 'ok' ? 'ok' : 'error', latency);\r\n                }\r\n                catch (e) {\r\n                    this.log('error', 'error in heartbeat callback', e);\r\n                }\r\n                this._heartbeatSentAt = null;\r\n                this.pendingHeartbeatRef = null;\r\n            }\r\n            // Log incoming message\r\n            const { topic, event, payload, ref } = msg;\r\n            const refString = ref ? `(${ref})` : '';\r\n            const status = payload.status || '';\r\n            this.log('receive', `${status} ${topic} ${event} ${refString}`.trim(), payload);\r\n            // Route message to appropriate channels\r\n            this.channels\r\n                .filter((channel) => channel._isMember(topic))\r\n                .forEach((channel) => channel._trigger(event, payload, ref));\r\n            this._triggerStateCallbacks('message', msg);\r\n        });\r\n    }\r\n    /**\r\n     * Clear specific timer\r\n     * @internal\r\n     */\r\n    _clearTimer(timer) {\r\n        var _a;\r\n        if (timer === 'heartbeat' && this.heartbeatTimer) {\r\n            clearInterval(this.heartbeatTimer);\r\n            this.heartbeatTimer = undefined;\r\n        }\r\n        else if (timer === 'reconnect') {\r\n            (_a = this.reconnectTimer) === null || _a === void 0 ? void 0 : _a.reset();\r\n        }\r\n    }\r\n    /**\r\n     * Clear all timers\r\n     * @internal\r\n     */\r\n    _clearAllTimers() {\r\n        this._clearTimer('heartbeat');\r\n        this._clearTimer('reconnect');\r\n    }\r\n    /**\r\n     * Setup connection handlers for WebSocket events\r\n     * @internal\r\n     */\r\n    _setupConnectionHandlers() {\r\n        if (!this.conn)\r\n            return;\r\n        // Set binary type if supported (browsers and most WebSocket implementations)\r\n        if ('binaryType' in this.conn) {\r\n            ;\r\n            this.conn.binaryType = 'arraybuffer';\r\n        }\r\n        this.conn.onopen = () => this._onConnOpen();\r\n        this.conn.onerror = (error) => this._onConnError(error);\r\n        this.conn.onmessage = (event) => this._onConnMessage(event);\r\n        this.conn.onclose = (event) => this._onConnClose(event);\r\n        if (this.conn.readyState === constants_1.SOCKET_STATES.open) {\r\n            this._onConnOpen();\r\n        }\r\n    }\r\n    /**\r\n     * Teardown connection and cleanup resources\r\n     * @internal\r\n     */\r\n    _teardownConnection() {\r\n        if (this.conn) {\r\n            if (this.conn.readyState === constants_1.SOCKET_STATES.open ||\r\n                this.conn.readyState === constants_1.SOCKET_STATES.connecting) {\r\n                try {\r\n                    this.conn.close();\r\n                }\r\n                catch (e) {\r\n                    this.log('error', 'Error closing connection', e);\r\n                }\r\n            }\r\n            this.conn.onopen = null;\r\n            this.conn.onerror = null;\r\n            this.conn.onmessage = null;\r\n            this.conn.onclose = null;\r\n            this.conn = null;\r\n        }\r\n        this._clearAllTimers();\r\n        this._terminateWorker();\r\n        this.channels.forEach((channel) => channel.teardown());\r\n    }\r\n    /** @internal */\r\n    _onConnOpen() {\r\n        this._setConnectionState('connected');\r\n        this.log('transport', `connected to ${this.endpointURL()}`);\r\n        // Wait for any pending auth operations before flushing send buffer\r\n        // This ensures channel join messages include the correct access token\r\n        const authPromise = this._authPromise ||\r\n            (this.accessToken && !this.accessTokenValue ? this.setAuth() : Promise.resolve());\r\n        authPromise\r\n            .then(() => {\r\n            this.flushSendBuffer();\r\n        })\r\n            .catch((e) => {\r\n            this.log('error', 'error waiting for auth on connect', e);\r\n            // Proceed anyway to avoid hanging connections\r\n            this.flushSendBuffer();\r\n        });\r\n        this._clearTimer('reconnect');\r\n        if (!this.worker) {\r\n            this._startHeartbeat();\r\n        }\r\n        else {\r\n            if (!this.workerRef) {\r\n                this._startWorkerHeartbeat();\r\n            }\r\n        }\r\n        this._triggerStateCallbacks('open');\r\n    }\r\n    /** @internal */\r\n    _startHeartbeat() {\r\n        this.heartbeatTimer && clearInterval(this.heartbeatTimer);\r\n        this.heartbeatTimer = setInterval(() => this.sendHeartbeat(), this.heartbeatIntervalMs);\r\n    }\r\n    /** @internal */\r\n    _startWorkerHeartbeat() {\r\n        if (this.workerUrl) {\r\n            this.log('worker', `starting worker for from ${this.workerUrl}`);\r\n        }\r\n        else {\r\n            this.log('worker', `starting default worker`);\r\n        }\r\n        const objectUrl = this._workerObjectUrl(this.workerUrl);\r\n        this.workerRef = new Worker(objectUrl);\r\n        this.workerRef.onerror = (error) => {\r\n            this.log('worker', 'worker error', error.message);\r\n            this._terminateWorker();\r\n        };\r\n        this.workerRef.onmessage = (event) => {\r\n            if (event.data.event === 'keepAlive') {\r\n                this.sendHeartbeat();\r\n            }\r\n        };\r\n        this.workerRef.postMessage({\r\n            event: 'start',\r\n            interval: this.heartbeatIntervalMs,\r\n        });\r\n    }\r\n    /**\r\n     * Terminate the Web Worker and clear the reference\r\n     * @internal\r\n     */\r\n    _terminateWorker() {\r\n        if (this.workerRef) {\r\n            this.log('worker', 'terminating worker');\r\n            this.workerRef.terminate();\r\n            this.workerRef = undefined;\r\n        }\r\n    }\r\n    /** @internal */\r\n    _onConnClose(event) {\r\n        var _a;\r\n        this._setConnectionState('disconnected');\r\n        this.log('transport', 'close', event);\r\n        this._triggerChanError();\r\n        this._clearTimer('heartbeat');\r\n        // Only schedule reconnection if it wasn't a manual disconnect\r\n        if (!this._wasManualDisconnect) {\r\n            (_a = this.reconnectTimer) === null || _a === void 0 ? void 0 : _a.scheduleTimeout();\r\n        }\r\n        this._triggerStateCallbacks('close', event);\r\n    }\r\n    /** @internal */\r\n    _onConnError(error) {\r\n        this._setConnectionState('disconnected');\r\n        this.log('transport', `${error}`);\r\n        this._triggerChanError();\r\n        this._triggerStateCallbacks('error', error);\r\n        try {\r\n            this.heartbeatCallback('error');\r\n        }\r\n        catch (e) {\r\n            this.log('error', 'error in heartbeat callback', e);\r\n        }\r\n    }\r\n    /** @internal */\r\n    _triggerChanError() {\r\n        this.channels.forEach((channel) => channel._trigger(constants_1.CHANNEL_EVENTS.error));\r\n    }\r\n    /** @internal */\r\n    _appendParams(url, params) {\r\n        if (Object.keys(params).length === 0) {\r\n            return url;\r\n        }\r\n        const prefix = url.match(/\\?/) ? '&' : '?';\r\n        const query = new URLSearchParams(params);\r\n        return `${url}${prefix}${query}`;\r\n    }\r\n    _workerObjectUrl(url) {\r\n        let result_url;\r\n        if (url) {\r\n            result_url = url;\r\n        }\r\n        else {\r\n            const blob = new Blob([WORKER_SCRIPT], { type: 'application/javascript' });\r\n            result_url = URL.createObjectURL(blob);\r\n        }\r\n        return result_url;\r\n    }\r\n    /**\r\n     * Set connection state with proper state management\r\n     * @internal\r\n     */\r\n    _setConnectionState(state, manual = false) {\r\n        this._connectionState = state;\r\n        if (state === 'connecting') {\r\n            this._wasManualDisconnect = false;\r\n        }\r\n        else if (state === 'disconnecting') {\r\n            this._wasManualDisconnect = manual;\r\n        }\r\n    }\r\n    /**\r\n     * Perform the actual auth operation\r\n     * @internal\r\n     */\r\n    async _performAuth(token = null) {\r\n        let tokenToSend;\r\n        let isManualToken = false;\r\n        if (token) {\r\n            tokenToSend = token;\r\n            // Track if this is a manually-provided token\r\n            isManualToken = true;\r\n        }\r\n        else if (this.accessToken) {\r\n            // Call the accessToken callback to get fresh token\r\n            try {\r\n                tokenToSend = await this.accessToken();\r\n            }\r\n            catch (e) {\r\n                this.log('error', 'Error fetching access token from callback', e);\r\n                // Fall back to cached value if callback fails\r\n                tokenToSend = this.accessTokenValue;\r\n            }\r\n        }\r\n        else {\r\n            tokenToSend = this.accessTokenValue;\r\n        }\r\n        // Track whether this token was manually set or fetched via callback\r\n        if (isManualToken) {\r\n            this._manuallySetToken = true;\r\n        }\r\n        else if (this.accessToken) {\r\n            // If we used the callback, clear the manual flag\r\n            this._manuallySetToken = false;\r\n        }\r\n        if (this.accessTokenValue != tokenToSend) {\r\n            this.accessTokenValue = tokenToSend;\r\n            this.channels.forEach((channel) => {\r\n                const payload = {\r\n                    access_token: tokenToSend,\r\n                    version: constants_1.DEFAULT_VERSION,\r\n                };\r\n                tokenToSend && channel.updateJoinPayload(payload);\r\n                if (channel.joinedOnce && channel._isJoined()) {\r\n                    channel._push(constants_1.CHANNEL_EVENTS.access_token, {\r\n                        access_token: tokenToSend,\r\n                    });\r\n                }\r\n            });\r\n        }\r\n    }\r\n    /**\r\n     * Wait for any in-flight auth operations to complete\r\n     * @internal\r\n     */\r\n    async _waitForAuthIfNeeded() {\r\n        if (this._authPromise) {\r\n            await this._authPromise;\r\n        }\r\n    }\r\n    /**\r\n     * Safely call setAuth with standardized error handling\r\n     * @internal\r\n     */\r\n    _setAuthSafely(context = 'general') {\r\n        // Only refresh auth if using callback-based tokens\r\n        if (!this._isManualToken()) {\r\n            this.setAuth().catch((e) => {\r\n                this.log('error', `Error setting auth in ${context}`, e);\r\n            });\r\n        }\r\n    }\r\n    /**\r\n     * Trigger state change callbacks with proper error handling\r\n     * @internal\r\n     */\r\n    _triggerStateCallbacks(event, data) {\r\n        try {\r\n            this.stateChangeCallbacks[event].forEach((callback) => {\r\n                try {\r\n                    callback(data);\r\n                }\r\n                catch (e) {\r\n                    this.log('error', `error in ${event} callback`, e);\r\n                }\r\n            });\r\n        }\r\n        catch (e) {\r\n            this.log('error', `error triggering ${event} callbacks`, e);\r\n        }\r\n    }\r\n    /**\r\n     * Setup reconnection timer with proper configuration\r\n     * @internal\r\n     */\r\n    _setupReconnectionTimer() {\r\n        this.reconnectTimer = new timer_1.default(async () => {\r\n            setTimeout(async () => {\r\n                await this._waitForAuthIfNeeded();\r\n                if (!this.isConnected()) {\r\n                    this.connect();\r\n                }\r\n            }, CONNECTION_TIMEOUTS.RECONNECT_DELAY);\r\n        }, this.reconnectAfterMs);\r\n    }\r\n    /**\r\n     * Initialize client options with defaults\r\n     * @internal\r\n     */\r\n    _initializeOptions(options) {\r\n        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m;\r\n        // Set defaults\r\n        this.transport = (_a = options === null || options === void 0 ? void 0 : options.transport) !== null && _a !== void 0 ? _a : null;\r\n        this.timeout = (_b = options === null || options === void 0 ? void 0 : options.timeout) !== null && _b !== void 0 ? _b : constants_1.DEFAULT_TIMEOUT;\r\n        this.heartbeatIntervalMs =\r\n            (_c = options === null || options === void 0 ? void 0 : options.heartbeatIntervalMs) !== null && _c !== void 0 ? _c : CONNECTION_TIMEOUTS.HEARTBEAT_INTERVAL;\r\n        this.worker = (_d = options === null || options === void 0 ? void 0 : options.worker) !== null && _d !== void 0 ? _d : false;\r\n        this.accessToken = (_e = options === null || options === void 0 ? void 0 : options.accessToken) !== null && _e !== void 0 ? _e : null;\r\n        this.heartbeatCallback = (_f = options === null || options === void 0 ? void 0 : options.heartbeatCallback) !== null && _f !== void 0 ? _f : noop;\r\n        this.vsn = (_g = options === null || options === void 0 ? void 0 : options.vsn) !== null && _g !== void 0 ? _g : constants_1.DEFAULT_VSN;\r\n        // Handle special cases\r\n        if (options === null || options === void 0 ? void 0 : options.params)\r\n            this.params = options.params;\r\n        if (options === null || options === void 0 ? void 0 : options.logger)\r\n            this.logger = options.logger;\r\n        if ((options === null || options === void 0 ? void 0 : options.logLevel) || (options === null || options === void 0 ? void 0 : options.log_level)) {\r\n            this.logLevel = options.logLevel || options.log_level;\r\n            this.params = Object.assign(Object.assign({}, this.params), { log_level: this.logLevel });\r\n        }\r\n        // Set up functions with defaults\r\n        this.reconnectAfterMs =\r\n            (_h = options === null || options === void 0 ? void 0 : options.reconnectAfterMs) !== null && _h !== void 0 ? _h : ((tries) => {\r\n                return RECONNECT_INTERVALS[tries - 1] || DEFAULT_RECONNECT_FALLBACK;\r\n            });\r\n        switch (this.vsn) {\r\n            case constants_1.VSN_1_0_0:\r\n                this.encode =\r\n                    (_j = options === null || options === void 0 ? void 0 : options.encode) !== null && _j !== void 0 ? _j : ((payload, callback) => {\r\n                        return callback(JSON.stringify(payload));\r\n                    });\r\n                this.decode =\r\n                    (_k = options === null || options === void 0 ? void 0 : options.decode) !== null && _k !== void 0 ? _k : ((payload, callback) => {\r\n                        return callback(JSON.parse(payload));\r\n                    });\r\n                break;\r\n            case constants_1.VSN_2_0_0:\r\n                this.encode = (_l = options === null || options === void 0 ? void 0 : options.encode) !== null && _l !== void 0 ? _l : this.serializer.encode.bind(this.serializer);\r\n                this.decode = (_m = options === null || options === void 0 ? void 0 : options.decode) !== null && _m !== void 0 ? _m : this.serializer.decode.bind(this.serializer);\r\n                break;\r\n            default:\r\n                throw new Error(`Unsupported serializer version: ${this.vsn}`);\r\n        }\r\n        // Handle worker setup\r\n        if (this.worker) {\r\n            if (typeof window !== 'undefined' && !window.Worker) {\r\n                throw new Error('Web Worker is not supported');\r\n            }\r\n            this.workerUrl = options === null || options === void 0 ? void 0 : options.workerUrl;\r\n        }\r\n    }\r\n}\r\nexports.default = RealtimeClient;\r\n//# sourceMappingURL=RealtimeClient.js.map\n};"],
"names":["shadow$provide","require","module","exports","Object","defineProperty","value","tslib_1","websocket_factory_1","__importDefault","constants_1","serializer_1","timer_1","transformers_1","RealtimeChannel_1","noop","RECONNECT_INTERVALS","RealtimeClient","constructor","endPoint","options","_a","apiKey","accessTokenValue","_manuallySetToken","channels","httpEndpoint","headers","params","timeout","DEFAULT_TIMEOUT","transport","heartbeatIntervalMs","HEARTBEAT_INTERVAL","heartbeatTimer","undefined","pendingHeartbeatRef","heartbeatCallback","ref","reconnectTimer","vsn","DEFAULT_VSN","logger","conn","sendBuffer","serializer","default","stateChangeCallbacks","open","close","error","message","accessToken","_connectionState","_wasManualDisconnect","_heartbeatSentAt","_authPromise","_resolveFetch","customFetch","this._resolveFetch","args","fetch","apikey","Error","TRANSPORTS","websocket","httpEndpointURL","_initializeOptions","_setupReconnectionTimer","connect","isConnecting","isDisconnecting","isConnected","_setConnectionState","_setAuthSafely","endpointURL","createWebSocket","errorMessage","includes","_setupConnectionHandlers","_appendParams","assign","disconnect","code","reason","fallbackTimer","setTimeout","onclose","this.conn.onclose","clearTimeout","_teardownConnection","getChannels","removeChannel","channel","status","unsubscribe","length","removeAllChannels","values_1","Promise","all","map","log","kind","msg","data","connectionState","readyState","SOCKET_STATES","connecting","CONNECTION_STATE","Connecting","Open","closing","Closing","Closed","topic","config","realtimeTopic","exists","find","c","chan","push","event","payload","callback","encode","result","send","setAuth","token","_performAuth","_isManualToken","sendHeartbeat","e","WS_CLOSE_NORMAL","scheduleTimeout","HEARTBEAT_TIMEOUT_FALLBACK","Date","now","_makeRef","onHeartbeat","flushSendBuffer","forEach","newRef","toString","_leaveOpenTopic","dupChannel","_isJoined","_isJoining","_remove","filter","_onConnMessage","rawMessage","decode","latency","refString","trim","_isMember","_trigger","_triggerStateCallbacks","_clearTimer","timer","clearInterval","reset","_clearAllTimers","binaryType","onopen","this.conn.onopen","_onConnOpen","onerror","this.conn.onerror","_onConnError","onmessage","this.conn.onmessage","_onConnClose","_terminateWorker","teardown","then","resolve","catch","worker","workerRef","_startWorkerHeartbeat","_startHeartbeat","setInterval","workerUrl","objectUrl","_workerObjectUrl","Worker","this.workerRef.onerror","this.workerRef.onmessage","postMessage","interval","terminate","_triggerChanError","CHANNEL_EVENTS","url","keys","prefix","match","query","URLSearchParams","blob","Blob","WORKER_SCRIPT","type","result_url","URL","createObjectURL","state","manual","tokenToSend","isManualToken","access_token","version","DEFAULT_VERSION","updateJoinPayload","joinedOnce","_push","_waitForAuthIfNeeded","context","RECONNECT_DELAY","reconnectAfterMs","_b","_c","_d","_e","_f","_g","_h","_j","_k","_l","_m","logLevel","log_level","tries","DEFAULT_RECONNECT_FALLBACK","VSN_1_0_0","JSON","stringify","parse","VSN_2_0_0","bind","window"]
}
