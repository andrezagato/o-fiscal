["^ ","~:resource-id",["~:shadow.build.npm/resource","node_modules/@supabase/realtime-js/dist/main/RealtimePresence.js"],"~:js","shadow$provide[27]=function(S,ka,a){Object.defineProperty(a,\"__esModule\",{value:!0});a.REALTIME_PRESENCE_LISTEN_EVENTS=void 0;var I;(function(D){D.SYNC=\"sync\";D.JOIN=\"join\";D.LEAVE=\"leave\"})(I||(a.REALTIME_PRESENCE_LISTEN_EVENTS=I={}));class q{constructor(D,C){this.channel=D;this.state={};this.pendingDiffs=[];this.joinRef=null;this.enabled=!1;this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};D=(C===null||C===void 0?void 0:C.events)||{state:\"presence_state\",diff:\"presence_diff\"};this.channel._on(D.state,\n{},G=>{const {onJoin:E,onLeave:M,onSync:d}=this.caller;this.joinRef=this.channel._joinRef();this.state=q.syncState(this.state,G,E,M);this.pendingDiffs.forEach(K=>{this.state=q.syncDiff(this.state,K,E,M)});this.pendingDiffs=[];d()});this.channel._on(D.diff,{},G=>{const {onJoin:E,onLeave:M,onSync:d}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(G):(this.state=q.syncDiff(this.state,G,E,M),d())});this.onJoin((G,E,M)=>{this.channel._trigger(\"presence\",{event:\"join\",key:G,currentPresences:E,\nnewPresences:M})});this.onLeave((G,E,M)=>{this.channel._trigger(\"presence\",{event:\"leave\",key:G,currentPresences:E,leftPresences:M})});this.onSync(()=>{this.channel._trigger(\"presence\",{event:\"sync\"})})}static syncState(D,C,G,E){const M=this.cloneDeep(D),d=this.transformState(C),K={},p={};this.map(M,(k,y)=>{d[k]||(p[k]=y)});this.map(d,(k,y)=>{var v=M[k];if(v){const z=y.map(l=>l.presence_ref),J=v.map(l=>l.presence_ref);y=y.filter(l=>J.indexOf(l.presence_ref)<0);v=v.filter(l=>z.indexOf(l.presence_ref)<\n0);y.length>0&&(K[k]=y);v.length>0&&(p[k]=v)}else K[k]=y});return this.syncDiff(M,{joins:K,leaves:p},G,E)}static syncDiff(D,C,G,E){const {joins:M,leaves:d}={joins:this.transformState(C.joins),leaves:this.transformState(C.leaves)};G||=()=>{};E||=()=>{};this.map(M,(K,p)=>{var k;const y=(k=D[K])!==null&&k!==void 0?k:[];D[K]=this.cloneDeep(p);if(y.length>0){const v=D[K].map(z=>z.presence_ref);k=y.filter(z=>v.indexOf(z.presence_ref)<0);D[K].unshift(...k)}G(K,y,p)});this.map(d,(K,p)=>{let k=D[K];if(k){var y=\np.map(v=>v.presence_ref);k=k.filter(v=>y.indexOf(v.presence_ref)<0);D[K]=k;E(K,k,p);k.length===0&&delete D[K]}});return D}static map(D,C){return Object.getOwnPropertyNames(D).map(G=>C(G,D[G]))}static transformState(D){D=this.cloneDeep(D);return Object.getOwnPropertyNames(D).reduce((C,G)=>{const E=D[G];C[G]=\"metas\"in E?E.metas.map(M=>{M.presence_ref=M.phx_ref;delete M.phx_ref;delete M.phx_ref_prev;return M}):E;return C},{})}static cloneDeep(D){return JSON.parse(JSON.stringify(D))}onJoin(D){this.caller.onJoin=\nD}onLeave(D){this.caller.onLeave=D}onSync(D){this.caller.onSync=D}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}a.default=q}","~:source","shadow$provide[27] = function(require,module,exports) {\n\"use strict\";\r\n/*\r\n  This file draws heavily from https://github.com/phoenixframework/phoenix/blob/d344ec0a732ab4ee204215b31de69cf4be72e3bf/assets/js/phoenix/presence.js\r\n  License: https://github.com/phoenixframework/phoenix/blob/d344ec0a732ab4ee204215b31de69cf4be72e3bf/LICENSE.md\r\n*/\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.REALTIME_PRESENCE_LISTEN_EVENTS = void 0;\r\nvar REALTIME_PRESENCE_LISTEN_EVENTS;\r\n(function (REALTIME_PRESENCE_LISTEN_EVENTS) {\r\n    REALTIME_PRESENCE_LISTEN_EVENTS[\"SYNC\"] = \"sync\";\r\n    REALTIME_PRESENCE_LISTEN_EVENTS[\"JOIN\"] = \"join\";\r\n    REALTIME_PRESENCE_LISTEN_EVENTS[\"LEAVE\"] = \"leave\";\r\n})(REALTIME_PRESENCE_LISTEN_EVENTS || (exports.REALTIME_PRESENCE_LISTEN_EVENTS = REALTIME_PRESENCE_LISTEN_EVENTS = {}));\r\nclass RealtimePresence {\r\n    /**\r\n     * Creates a Presence helper that keeps the local presence state in sync with the server.\r\n     *\r\n     * @param channel - The realtime channel to bind to.\r\n     * @param opts - Optional custom event names, e.g. `{ events: { state: 'state', diff: 'diff' } }`.\r\n     *\r\n     * @example\r\n     * ```ts\r\n     * const presence = new RealtimePresence(channel)\r\n     *\r\n     * channel.on('presence', ({ event, key }) => {\r\n     *   console.log(`Presence ${event} on ${key}`)\r\n     * })\r\n     * ```\r\n     */\r\n    constructor(channel, opts) {\r\n        this.channel = channel;\r\n        this.state = {};\r\n        this.pendingDiffs = [];\r\n        this.joinRef = null;\r\n        this.enabled = false;\r\n        this.caller = {\r\n            onJoin: () => { },\r\n            onLeave: () => { },\r\n            onSync: () => { },\r\n        };\r\n        const events = (opts === null || opts === void 0 ? void 0 : opts.events) || {\r\n            state: 'presence_state',\r\n            diff: 'presence_diff',\r\n        };\r\n        this.channel._on(events.state, {}, (newState) => {\r\n            const { onJoin, onLeave, onSync } = this.caller;\r\n            this.joinRef = this.channel._joinRef();\r\n            this.state = RealtimePresence.syncState(this.state, newState, onJoin, onLeave);\r\n            this.pendingDiffs.forEach((diff) => {\r\n                this.state = RealtimePresence.syncDiff(this.state, diff, onJoin, onLeave);\r\n            });\r\n            this.pendingDiffs = [];\r\n            onSync();\r\n        });\r\n        this.channel._on(events.diff, {}, (diff) => {\r\n            const { onJoin, onLeave, onSync } = this.caller;\r\n            if (this.inPendingSyncState()) {\r\n                this.pendingDiffs.push(diff);\r\n            }\r\n            else {\r\n                this.state = RealtimePresence.syncDiff(this.state, diff, onJoin, onLeave);\r\n                onSync();\r\n            }\r\n        });\r\n        this.onJoin((key, currentPresences, newPresences) => {\r\n            this.channel._trigger('presence', {\r\n                event: 'join',\r\n                key,\r\n                currentPresences,\r\n                newPresences,\r\n            });\r\n        });\r\n        this.onLeave((key, currentPresences, leftPresences) => {\r\n            this.channel._trigger('presence', {\r\n                event: 'leave',\r\n                key,\r\n                currentPresences,\r\n                leftPresences,\r\n            });\r\n        });\r\n        this.onSync(() => {\r\n            this.channel._trigger('presence', { event: 'sync' });\r\n        });\r\n    }\r\n    /**\r\n     * Used to sync the list of presences on the server with the\r\n     * client's state.\r\n     *\r\n     * An optional `onJoin` and `onLeave` callback can be provided to\r\n     * react to changes in the client's local presences across\r\n     * disconnects and reconnects with the server.\r\n     *\r\n     * @internal\r\n     */\r\n    static syncState(currentState, newState, onJoin, onLeave) {\r\n        const state = this.cloneDeep(currentState);\r\n        const transformedState = this.transformState(newState);\r\n        const joins = {};\r\n        const leaves = {};\r\n        this.map(state, (key, presences) => {\r\n            if (!transformedState[key]) {\r\n                leaves[key] = presences;\r\n            }\r\n        });\r\n        this.map(transformedState, (key, newPresences) => {\r\n            const currentPresences = state[key];\r\n            if (currentPresences) {\r\n                const newPresenceRefs = newPresences.map((m) => m.presence_ref);\r\n                const curPresenceRefs = currentPresences.map((m) => m.presence_ref);\r\n                const joinedPresences = newPresences.filter((m) => curPresenceRefs.indexOf(m.presence_ref) < 0);\r\n                const leftPresences = currentPresences.filter((m) => newPresenceRefs.indexOf(m.presence_ref) < 0);\r\n                if (joinedPresences.length > 0) {\r\n                    joins[key] = joinedPresences;\r\n                }\r\n                if (leftPresences.length > 0) {\r\n                    leaves[key] = leftPresences;\r\n                }\r\n            }\r\n            else {\r\n                joins[key] = newPresences;\r\n            }\r\n        });\r\n        return this.syncDiff(state, { joins, leaves }, onJoin, onLeave);\r\n    }\r\n    /**\r\n     * Used to sync a diff of presence join and leave events from the\r\n     * server, as they happen.\r\n     *\r\n     * Like `syncState`, `syncDiff` accepts optional `onJoin` and\r\n     * `onLeave` callbacks to react to a user joining or leaving from a\r\n     * device.\r\n     *\r\n     * @internal\r\n     */\r\n    static syncDiff(state, diff, onJoin, onLeave) {\r\n        const { joins, leaves } = {\r\n            joins: this.transformState(diff.joins),\r\n            leaves: this.transformState(diff.leaves),\r\n        };\r\n        if (!onJoin) {\r\n            onJoin = () => { };\r\n        }\r\n        if (!onLeave) {\r\n            onLeave = () => { };\r\n        }\r\n        this.map(joins, (key, newPresences) => {\r\n            var _a;\r\n            const currentPresences = (_a = state[key]) !== null && _a !== void 0 ? _a : [];\r\n            state[key] = this.cloneDeep(newPresences);\r\n            if (currentPresences.length > 0) {\r\n                const joinedPresenceRefs = state[key].map((m) => m.presence_ref);\r\n                const curPresences = currentPresences.filter((m) => joinedPresenceRefs.indexOf(m.presence_ref) < 0);\r\n                state[key].unshift(...curPresences);\r\n            }\r\n            onJoin(key, currentPresences, newPresences);\r\n        });\r\n        this.map(leaves, (key, leftPresences) => {\r\n            let currentPresences = state[key];\r\n            if (!currentPresences)\r\n                return;\r\n            const presenceRefsToRemove = leftPresences.map((m) => m.presence_ref);\r\n            currentPresences = currentPresences.filter((m) => presenceRefsToRemove.indexOf(m.presence_ref) < 0);\r\n            state[key] = currentPresences;\r\n            onLeave(key, currentPresences, leftPresences);\r\n            if (currentPresences.length === 0)\r\n                delete state[key];\r\n        });\r\n        return state;\r\n    }\r\n    /** @internal */\r\n    static map(obj, func) {\r\n        return Object.getOwnPropertyNames(obj).map((key) => func(key, obj[key]));\r\n    }\r\n    /**\r\n     * Remove 'metas' key\r\n     * Change 'phx_ref' to 'presence_ref'\r\n     * Remove 'phx_ref' and 'phx_ref_prev'\r\n     *\r\n     * @example\r\n     * // returns {\r\n     *  abc123: [\r\n     *    { presence_ref: '2', user_id: 1 },\r\n     *    { presence_ref: '3', user_id: 2 }\r\n     *  ]\r\n     * }\r\n     * RealtimePresence.transformState({\r\n     *  abc123: {\r\n     *    metas: [\r\n     *      { phx_ref: '2', phx_ref_prev: '1' user_id: 1 },\r\n     *      { phx_ref: '3', user_id: 2 }\r\n     *    ]\r\n     *  }\r\n     * })\r\n     *\r\n     * @internal\r\n     */\r\n    static transformState(state) {\r\n        state = this.cloneDeep(state);\r\n        return Object.getOwnPropertyNames(state).reduce((newState, key) => {\r\n            const presences = state[key];\r\n            if ('metas' in presences) {\r\n                newState[key] = presences.metas.map((presence) => {\r\n                    presence['presence_ref'] = presence['phx_ref'];\r\n                    delete presence['phx_ref'];\r\n                    delete presence['phx_ref_prev'];\r\n                    return presence;\r\n                });\r\n            }\r\n            else {\r\n                newState[key] = presences;\r\n            }\r\n            return newState;\r\n        }, {});\r\n    }\r\n    /** @internal */\r\n    static cloneDeep(obj) {\r\n        return JSON.parse(JSON.stringify(obj));\r\n    }\r\n    /** @internal */\r\n    onJoin(callback) {\r\n        this.caller.onJoin = callback;\r\n    }\r\n    /** @internal */\r\n    onLeave(callback) {\r\n        this.caller.onLeave = callback;\r\n    }\r\n    /** @internal */\r\n    onSync(callback) {\r\n        this.caller.onSync = callback;\r\n    }\r\n    /** @internal */\r\n    inPendingSyncState() {\r\n        return !this.joinRef || this.joinRef !== this.channel._joinRef();\r\n    }\r\n}\r\nexports.default = RealtimePresence;\r\n//# sourceMappingURL=RealtimePresence.js.map\n};","~:removed-requires",["~#set",[]],"~:actual-requires",["^5",["~$shadow.js"]],"~:properties",["^5",["joinRef","onSync","onLeave","key","__esModule","newPresences","leaves","enabled","diff","currentPresences","event","leftPresences","onJoin","value","caller","joins","state","channel","pendingDiffs","default","REALTIME_PRESENCE_LISTEN_EVENTS"]],"~:compiled-at",1771869280850,"~:source-map-json","{\n\"version\":3,\n\"file\":\"module$node_modules$$supabase$realtime_js$dist$main$RealtimePresence.js\",\n\"lineCount\":6,\n\"mappings\":\"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\",\n\"sources\":[\"node_modules/@supabase/realtime-js/dist/main/RealtimePresence.js\"],\n\"sourcesContent\":[\"shadow$provide[27] = function(require,module,exports) {\\n\\\"use strict\\\";\\r\\n/*\\r\\n  This file draws heavily from https://github.com/phoenixframework/phoenix/blob/d344ec0a732ab4ee204215b31de69cf4be72e3bf/assets/js/phoenix/presence.js\\r\\n  License: https://github.com/phoenixframework/phoenix/blob/d344ec0a732ab4ee204215b31de69cf4be72e3bf/LICENSE.md\\r\\n*/\\r\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\r\\nexports.REALTIME_PRESENCE_LISTEN_EVENTS = void 0;\\r\\nvar REALTIME_PRESENCE_LISTEN_EVENTS;\\r\\n(function (REALTIME_PRESENCE_LISTEN_EVENTS) {\\r\\n    REALTIME_PRESENCE_LISTEN_EVENTS[\\\"SYNC\\\"] = \\\"sync\\\";\\r\\n    REALTIME_PRESENCE_LISTEN_EVENTS[\\\"JOIN\\\"] = \\\"join\\\";\\r\\n    REALTIME_PRESENCE_LISTEN_EVENTS[\\\"LEAVE\\\"] = \\\"leave\\\";\\r\\n})(REALTIME_PRESENCE_LISTEN_EVENTS || (exports.REALTIME_PRESENCE_LISTEN_EVENTS = REALTIME_PRESENCE_LISTEN_EVENTS = {}));\\r\\nclass RealtimePresence {\\r\\n    /**\\r\\n     * Creates a Presence helper that keeps the local presence state in sync with the server.\\r\\n     *\\r\\n     * @param channel - The realtime channel to bind to.\\r\\n     * @param opts - Optional custom event names, e.g. `{ events: { state: 'state', diff: 'diff' } }`.\\r\\n     *\\r\\n     * @example\\r\\n     * ```ts\\r\\n     * const presence = new RealtimePresence(channel)\\r\\n     *\\r\\n     * channel.on('presence', ({ event, key }) => {\\r\\n     *   console.log(`Presence ${event} on ${key}`)\\r\\n     * })\\r\\n     * ```\\r\\n     */\\r\\n    constructor(channel, opts) {\\r\\n        this.channel = channel;\\r\\n        this.state = {};\\r\\n        this.pendingDiffs = [];\\r\\n        this.joinRef = null;\\r\\n        this.enabled = false;\\r\\n        this.caller = {\\r\\n            onJoin: () => { },\\r\\n            onLeave: () => { },\\r\\n            onSync: () => { },\\r\\n        };\\r\\n        const events = (opts === null || opts === void 0 ? void 0 : opts.events) || {\\r\\n            state: 'presence_state',\\r\\n            diff: 'presence_diff',\\r\\n        };\\r\\n        this.channel._on(events.state, {}, (newState) => {\\r\\n            const { onJoin, onLeave, onSync } = this.caller;\\r\\n            this.joinRef = this.channel._joinRef();\\r\\n            this.state = RealtimePresence.syncState(this.state, newState, onJoin, onLeave);\\r\\n            this.pendingDiffs.forEach((diff) => {\\r\\n                this.state = RealtimePresence.syncDiff(this.state, diff, onJoin, onLeave);\\r\\n            });\\r\\n            this.pendingDiffs = [];\\r\\n            onSync();\\r\\n        });\\r\\n        this.channel._on(events.diff, {}, (diff) => {\\r\\n            const { onJoin, onLeave, onSync } = this.caller;\\r\\n            if (this.inPendingSyncState()) {\\r\\n                this.pendingDiffs.push(diff);\\r\\n            }\\r\\n            else {\\r\\n                this.state = RealtimePresence.syncDiff(this.state, diff, onJoin, onLeave);\\r\\n                onSync();\\r\\n            }\\r\\n        });\\r\\n        this.onJoin((key, currentPresences, newPresences) => {\\r\\n            this.channel._trigger('presence', {\\r\\n                event: 'join',\\r\\n                key,\\r\\n                currentPresences,\\r\\n                newPresences,\\r\\n            });\\r\\n        });\\r\\n        this.onLeave((key, currentPresences, leftPresences) => {\\r\\n            this.channel._trigger('presence', {\\r\\n                event: 'leave',\\r\\n                key,\\r\\n                currentPresences,\\r\\n                leftPresences,\\r\\n            });\\r\\n        });\\r\\n        this.onSync(() => {\\r\\n            this.channel._trigger('presence', { event: 'sync' });\\r\\n        });\\r\\n    }\\r\\n    /**\\r\\n     * Used to sync the list of presences on the server with the\\r\\n     * client's state.\\r\\n     *\\r\\n     * An optional `onJoin` and `onLeave` callback can be provided to\\r\\n     * react to changes in the client's local presences across\\r\\n     * disconnects and reconnects with the server.\\r\\n     *\\r\\n     * @internal\\r\\n     */\\r\\n    static syncState(currentState, newState, onJoin, onLeave) {\\r\\n        const state = this.cloneDeep(currentState);\\r\\n        const transformedState = this.transformState(newState);\\r\\n        const joins = {};\\r\\n        const leaves = {};\\r\\n        this.map(state, (key, presences) => {\\r\\n            if (!transformedState[key]) {\\r\\n                leaves[key] = presences;\\r\\n            }\\r\\n        });\\r\\n        this.map(transformedState, (key, newPresences) => {\\r\\n            const currentPresences = state[key];\\r\\n            if (currentPresences) {\\r\\n                const newPresenceRefs = newPresences.map((m) => m.presence_ref);\\r\\n                const curPresenceRefs = currentPresences.map((m) => m.presence_ref);\\r\\n                const joinedPresences = newPresences.filter((m) => curPresenceRefs.indexOf(m.presence_ref) < 0);\\r\\n                const leftPresences = currentPresences.filter((m) => newPresenceRefs.indexOf(m.presence_ref) < 0);\\r\\n                if (joinedPresences.length > 0) {\\r\\n                    joins[key] = joinedPresences;\\r\\n                }\\r\\n                if (leftPresences.length > 0) {\\r\\n                    leaves[key] = leftPresences;\\r\\n                }\\r\\n            }\\r\\n            else {\\r\\n                joins[key] = newPresences;\\r\\n            }\\r\\n        });\\r\\n        return this.syncDiff(state, { joins, leaves }, onJoin, onLeave);\\r\\n    }\\r\\n    /**\\r\\n     * Used to sync a diff of presence join and leave events from the\\r\\n     * server, as they happen.\\r\\n     *\\r\\n     * Like `syncState`, `syncDiff` accepts optional `onJoin` and\\r\\n     * `onLeave` callbacks to react to a user joining or leaving from a\\r\\n     * device.\\r\\n     *\\r\\n     * @internal\\r\\n     */\\r\\n    static syncDiff(state, diff, onJoin, onLeave) {\\r\\n        const { joins, leaves } = {\\r\\n            joins: this.transformState(diff.joins),\\r\\n            leaves: this.transformState(diff.leaves),\\r\\n        };\\r\\n        if (!onJoin) {\\r\\n            onJoin = () => { };\\r\\n        }\\r\\n        if (!onLeave) {\\r\\n            onLeave = () => { };\\r\\n        }\\r\\n        this.map(joins, (key, newPresences) => {\\r\\n            var _a;\\r\\n            const currentPresences = (_a = state[key]) !== null && _a !== void 0 ? _a : [];\\r\\n            state[key] = this.cloneDeep(newPresences);\\r\\n            if (currentPresences.length > 0) {\\r\\n                const joinedPresenceRefs = state[key].map((m) => m.presence_ref);\\r\\n                const curPresences = currentPresences.filter((m) => joinedPresenceRefs.indexOf(m.presence_ref) < 0);\\r\\n                state[key].unshift(...curPresences);\\r\\n            }\\r\\n            onJoin(key, currentPresences, newPresences);\\r\\n        });\\r\\n        this.map(leaves, (key, leftPresences) => {\\r\\n            let currentPresences = state[key];\\r\\n            if (!currentPresences)\\r\\n                return;\\r\\n            const presenceRefsToRemove = leftPresences.map((m) => m.presence_ref);\\r\\n            currentPresences = currentPresences.filter((m) => presenceRefsToRemove.indexOf(m.presence_ref) < 0);\\r\\n            state[key] = currentPresences;\\r\\n            onLeave(key, currentPresences, leftPresences);\\r\\n            if (currentPresences.length === 0)\\r\\n                delete state[key];\\r\\n        });\\r\\n        return state;\\r\\n    }\\r\\n    /** @internal */\\r\\n    static map(obj, func) {\\r\\n        return Object.getOwnPropertyNames(obj).map((key) => func(key, obj[key]));\\r\\n    }\\r\\n    /**\\r\\n     * Remove 'metas' key\\r\\n     * Change 'phx_ref' to 'presence_ref'\\r\\n     * Remove 'phx_ref' and 'phx_ref_prev'\\r\\n     *\\r\\n     * @example\\r\\n     * // returns {\\r\\n     *  abc123: [\\r\\n     *    { presence_ref: '2', user_id: 1 },\\r\\n     *    { presence_ref: '3', user_id: 2 }\\r\\n     *  ]\\r\\n     * }\\r\\n     * RealtimePresence.transformState({\\r\\n     *  abc123: {\\r\\n     *    metas: [\\r\\n     *      { phx_ref: '2', phx_ref_prev: '1' user_id: 1 },\\r\\n     *      { phx_ref: '3', user_id: 2 }\\r\\n     *    ]\\r\\n     *  }\\r\\n     * })\\r\\n     *\\r\\n     * @internal\\r\\n     */\\r\\n    static transformState(state) {\\r\\n        state = this.cloneDeep(state);\\r\\n        return Object.getOwnPropertyNames(state).reduce((newState, key) => {\\r\\n            const presences = state[key];\\r\\n            if ('metas' in presences) {\\r\\n                newState[key] = presences.metas.map((presence) => {\\r\\n                    presence['presence_ref'] = presence['phx_ref'];\\r\\n                    delete presence['phx_ref'];\\r\\n                    delete presence['phx_ref_prev'];\\r\\n                    return presence;\\r\\n                });\\r\\n            }\\r\\n            else {\\r\\n                newState[key] = presences;\\r\\n            }\\r\\n            return newState;\\r\\n        }, {});\\r\\n    }\\r\\n    /** @internal */\\r\\n    static cloneDeep(obj) {\\r\\n        return JSON.parse(JSON.stringify(obj));\\r\\n    }\\r\\n    /** @internal */\\r\\n    onJoin(callback) {\\r\\n        this.caller.onJoin = callback;\\r\\n    }\\r\\n    /** @internal */\\r\\n    onLeave(callback) {\\r\\n        this.caller.onLeave = callback;\\r\\n    }\\r\\n    /** @internal */\\r\\n    onSync(callback) {\\r\\n        this.caller.onSync = callback;\\r\\n    }\\r\\n    /** @internal */\\r\\n    inPendingSyncState() {\\r\\n        return !this.joinRef || this.joinRef !== this.channel._joinRef();\\r\\n    }\\r\\n}\\r\\nexports.default = RealtimePresence;\\r\\n//# sourceMappingURL=RealtimePresence.js.map\\n};\"],\n\"names\":[\"shadow$provide\",\"require\",\"module\",\"exports\",\"Object\",\"defineProperty\",\"value\",\"REALTIME_PRESENCE_LISTEN_EVENTS\",\"RealtimePresence\",\"constructor\",\"channel\",\"opts\",\"state\",\"pendingDiffs\",\"joinRef\",\"enabled\",\"caller\",\"onJoin\",\"onLeave\",\"onSync\",\"events\",\"diff\",\"_on\",\"newState\",\"_joinRef\",\"syncState\",\"forEach\",\"syncDiff\",\"inPendingSyncState\",\"push\",\"key\",\"currentPresences\",\"newPresences\",\"_trigger\",\"event\",\"leftPresences\",\"currentState\",\"cloneDeep\",\"transformedState\",\"transformState\",\"joins\",\"leaves\",\"map\",\"presences\",\"newPresenceRefs\",\"m\",\"presence_ref\",\"curPresenceRefs\",\"joinedPresences\",\"filter\",\"indexOf\",\"length\",\"_a\",\"joinedPresenceRefs\",\"curPresences\",\"unshift\",\"presenceRefsToRemove\",\"obj\",\"func\",\"getOwnPropertyNames\",\"reduce\",\"metas\",\"presence\",\"JSON\",\"parse\",\"stringify\",\"callback\",\"default\"]\n}\n"]