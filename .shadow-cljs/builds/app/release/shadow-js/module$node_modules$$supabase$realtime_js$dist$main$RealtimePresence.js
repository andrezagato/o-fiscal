["^ ","~:resource-id",["~:shadow.build.npm/resource","node_modules/@supabase/realtime-js/dist/main/RealtimePresence.js"],"~:js","shadow$provide[27]=function(I,R,a){Object.defineProperty(a,\"__esModule\",{value:!0});a.REALTIME_PRESENCE_LISTEN_EVENTS=void 0;var G;(function(x){x.SYNC=\"sync\";x.JOIN=\"join\";x.LEAVE=\"leave\"})(G||(a.REALTIME_PRESENCE_LISTEN_EVENTS=G={}));class l{constructor(x,w){this.channel=x;this.state={};this.pendingDiffs=[];this.joinRef=null;this.enabled=!1;this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};x=(w===null||w===void 0?void 0:w.events)||{state:\"presence_state\",diff:\"presence_diff\"};this.channel._on(x.state,\n{},z=>{const {onJoin:y,onLeave:F,onSync:b}=this.caller;this.joinRef=this.channel._joinRef();this.state=l.syncState(this.state,z,y,F);this.pendingDiffs.forEach(D=>{this.state=l.syncDiff(this.state,D,y,F)});this.pendingDiffs=[];b()});this.channel._on(x.diff,{},z=>{const {onJoin:y,onLeave:F,onSync:b}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(z):(this.state=l.syncDiff(this.state,z,y,F),b())});this.onJoin((z,y,F)=>{this.channel._trigger(\"presence\",{event:\"join\",key:z,currentPresences:y,\nnewPresences:F})});this.onLeave((z,y,F)=>{this.channel._trigger(\"presence\",{event:\"leave\",key:z,currentPresences:y,leftPresences:F})});this.onSync(()=>{this.channel._trigger(\"presence\",{event:\"sync\"})})}static syncState(x,w,z,y){const F=this.cloneDeep(x),b=this.transformState(w),D={},k={};this.map(F,(f,t)=>{b[f]||(k[f]=t)});this.map(b,(f,t)=>{var n=F[f];if(n){const v=t.map(h=>h.presence_ref),A=n.map(h=>h.presence_ref);t=t.filter(h=>A.indexOf(h.presence_ref)<0);n=n.filter(h=>v.indexOf(h.presence_ref)<\n0);t.length>0&&(D[f]=t);n.length>0&&(k[f]=n)}else D[f]=t});return this.syncDiff(F,{joins:D,leaves:k},z,y)}static syncDiff(x,w,z,y){const {joins:F,leaves:b}={joins:this.transformState(w.joins),leaves:this.transformState(w.leaves)};z||=()=>{};y||=()=>{};this.map(F,(D,k)=>{var f;const t=(f=x[D])!==null&&f!==void 0?f:[];x[D]=this.cloneDeep(k);if(t.length>0){const n=x[D].map(v=>v.presence_ref);f=t.filter(v=>n.indexOf(v.presence_ref)<0);x[D].unshift(...f)}z(D,t,k)});this.map(b,(D,k)=>{let f=x[D];if(f){var t=\nk.map(n=>n.presence_ref);f=f.filter(n=>t.indexOf(n.presence_ref)<0);x[D]=f;y(D,f,k);f.length===0&&delete x[D]}});return x}static map(x,w){return Object.getOwnPropertyNames(x).map(z=>w(z,x[z]))}static transformState(x){x=this.cloneDeep(x);return Object.getOwnPropertyNames(x).reduce((w,z)=>{const y=x[z];w[z]=\"metas\"in y?y.metas.map(F=>{F.presence_ref=F.phx_ref;delete F.phx_ref;delete F.phx_ref_prev;return F}):y;return w},{})}static cloneDeep(x){return JSON.parse(JSON.stringify(x))}onJoin(x){this.caller.onJoin=\nx}onLeave(x){this.caller.onLeave=x}onSync(x){this.caller.onSync=x}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}a.default=l}","~:source","shadow$provide[27] = function(require,module,exports) {\n\"use strict\";\n/*\n  This file draws heavily from https://github.com/phoenixframework/phoenix/blob/d344ec0a732ab4ee204215b31de69cf4be72e3bf/assets/js/phoenix/presence.js\n  License: https://github.com/phoenixframework/phoenix/blob/d344ec0a732ab4ee204215b31de69cf4be72e3bf/LICENSE.md\n*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.REALTIME_PRESENCE_LISTEN_EVENTS = void 0;\nvar REALTIME_PRESENCE_LISTEN_EVENTS;\n(function (REALTIME_PRESENCE_LISTEN_EVENTS) {\n    REALTIME_PRESENCE_LISTEN_EVENTS[\"SYNC\"] = \"sync\";\n    REALTIME_PRESENCE_LISTEN_EVENTS[\"JOIN\"] = \"join\";\n    REALTIME_PRESENCE_LISTEN_EVENTS[\"LEAVE\"] = \"leave\";\n})(REALTIME_PRESENCE_LISTEN_EVENTS || (exports.REALTIME_PRESENCE_LISTEN_EVENTS = REALTIME_PRESENCE_LISTEN_EVENTS = {}));\nclass RealtimePresence {\n    /**\n     * Creates a Presence helper that keeps the local presence state in sync with the server.\n     *\n     * @param channel - The realtime channel to bind to.\n     * @param opts - Optional custom event names, e.g. `{ events: { state: 'state', diff: 'diff' } }`.\n     *\n     * @example\n     * ```ts\n     * const presence = new RealtimePresence(channel)\n     *\n     * channel.on('presence', ({ event, key }) => {\n     *   console.log(`Presence ${event} on ${key}`)\n     * })\n     * ```\n     */\n    constructor(channel, opts) {\n        this.channel = channel;\n        this.state = {};\n        this.pendingDiffs = [];\n        this.joinRef = null;\n        this.enabled = false;\n        this.caller = {\n            onJoin: () => { },\n            onLeave: () => { },\n            onSync: () => { },\n        };\n        const events = (opts === null || opts === void 0 ? void 0 : opts.events) || {\n            state: 'presence_state',\n            diff: 'presence_diff',\n        };\n        this.channel._on(events.state, {}, (newState) => {\n            const { onJoin, onLeave, onSync } = this.caller;\n            this.joinRef = this.channel._joinRef();\n            this.state = RealtimePresence.syncState(this.state, newState, onJoin, onLeave);\n            this.pendingDiffs.forEach((diff) => {\n                this.state = RealtimePresence.syncDiff(this.state, diff, onJoin, onLeave);\n            });\n            this.pendingDiffs = [];\n            onSync();\n        });\n        this.channel._on(events.diff, {}, (diff) => {\n            const { onJoin, onLeave, onSync } = this.caller;\n            if (this.inPendingSyncState()) {\n                this.pendingDiffs.push(diff);\n            }\n            else {\n                this.state = RealtimePresence.syncDiff(this.state, diff, onJoin, onLeave);\n                onSync();\n            }\n        });\n        this.onJoin((key, currentPresences, newPresences) => {\n            this.channel._trigger('presence', {\n                event: 'join',\n                key,\n                currentPresences,\n                newPresences,\n            });\n        });\n        this.onLeave((key, currentPresences, leftPresences) => {\n            this.channel._trigger('presence', {\n                event: 'leave',\n                key,\n                currentPresences,\n                leftPresences,\n            });\n        });\n        this.onSync(() => {\n            this.channel._trigger('presence', { event: 'sync' });\n        });\n    }\n    /**\n     * Used to sync the list of presences on the server with the\n     * client's state.\n     *\n     * An optional `onJoin` and `onLeave` callback can be provided to\n     * react to changes in the client's local presences across\n     * disconnects and reconnects with the server.\n     *\n     * @internal\n     */\n    static syncState(currentState, newState, onJoin, onLeave) {\n        const state = this.cloneDeep(currentState);\n        const transformedState = this.transformState(newState);\n        const joins = {};\n        const leaves = {};\n        this.map(state, (key, presences) => {\n            if (!transformedState[key]) {\n                leaves[key] = presences;\n            }\n        });\n        this.map(transformedState, (key, newPresences) => {\n            const currentPresences = state[key];\n            if (currentPresences) {\n                const newPresenceRefs = newPresences.map((m) => m.presence_ref);\n                const curPresenceRefs = currentPresences.map((m) => m.presence_ref);\n                const joinedPresences = newPresences.filter((m) => curPresenceRefs.indexOf(m.presence_ref) < 0);\n                const leftPresences = currentPresences.filter((m) => newPresenceRefs.indexOf(m.presence_ref) < 0);\n                if (joinedPresences.length > 0) {\n                    joins[key] = joinedPresences;\n                }\n                if (leftPresences.length > 0) {\n                    leaves[key] = leftPresences;\n                }\n            }\n            else {\n                joins[key] = newPresences;\n            }\n        });\n        return this.syncDiff(state, { joins, leaves }, onJoin, onLeave);\n    }\n    /**\n     * Used to sync a diff of presence join and leave events from the\n     * server, as they happen.\n     *\n     * Like `syncState`, `syncDiff` accepts optional `onJoin` and\n     * `onLeave` callbacks to react to a user joining or leaving from a\n     * device.\n     *\n     * @internal\n     */\n    static syncDiff(state, diff, onJoin, onLeave) {\n        const { joins, leaves } = {\n            joins: this.transformState(diff.joins),\n            leaves: this.transformState(diff.leaves),\n        };\n        if (!onJoin) {\n            onJoin = () => { };\n        }\n        if (!onLeave) {\n            onLeave = () => { };\n        }\n        this.map(joins, (key, newPresences) => {\n            var _a;\n            const currentPresences = (_a = state[key]) !== null && _a !== void 0 ? _a : [];\n            state[key] = this.cloneDeep(newPresences);\n            if (currentPresences.length > 0) {\n                const joinedPresenceRefs = state[key].map((m) => m.presence_ref);\n                const curPresences = currentPresences.filter((m) => joinedPresenceRefs.indexOf(m.presence_ref) < 0);\n                state[key].unshift(...curPresences);\n            }\n            onJoin(key, currentPresences, newPresences);\n        });\n        this.map(leaves, (key, leftPresences) => {\n            let currentPresences = state[key];\n            if (!currentPresences)\n                return;\n            const presenceRefsToRemove = leftPresences.map((m) => m.presence_ref);\n            currentPresences = currentPresences.filter((m) => presenceRefsToRemove.indexOf(m.presence_ref) < 0);\n            state[key] = currentPresences;\n            onLeave(key, currentPresences, leftPresences);\n            if (currentPresences.length === 0)\n                delete state[key];\n        });\n        return state;\n    }\n    /** @internal */\n    static map(obj, func) {\n        return Object.getOwnPropertyNames(obj).map((key) => func(key, obj[key]));\n    }\n    /**\n     * Remove 'metas' key\n     * Change 'phx_ref' to 'presence_ref'\n     * Remove 'phx_ref' and 'phx_ref_prev'\n     *\n     * @example\n     * // returns {\n     *  abc123: [\n     *    { presence_ref: '2', user_id: 1 },\n     *    { presence_ref: '3', user_id: 2 }\n     *  ]\n     * }\n     * RealtimePresence.transformState({\n     *  abc123: {\n     *    metas: [\n     *      { phx_ref: '2', phx_ref_prev: '1' user_id: 1 },\n     *      { phx_ref: '3', user_id: 2 }\n     *    ]\n     *  }\n     * })\n     *\n     * @internal\n     */\n    static transformState(state) {\n        state = this.cloneDeep(state);\n        return Object.getOwnPropertyNames(state).reduce((newState, key) => {\n            const presences = state[key];\n            if ('metas' in presences) {\n                newState[key] = presences.metas.map((presence) => {\n                    presence['presence_ref'] = presence['phx_ref'];\n                    delete presence['phx_ref'];\n                    delete presence['phx_ref_prev'];\n                    return presence;\n                });\n            }\n            else {\n                newState[key] = presences;\n            }\n            return newState;\n        }, {});\n    }\n    /** @internal */\n    static cloneDeep(obj) {\n        return JSON.parse(JSON.stringify(obj));\n    }\n    /** @internal */\n    onJoin(callback) {\n        this.caller.onJoin = callback;\n    }\n    /** @internal */\n    onLeave(callback) {\n        this.caller.onLeave = callback;\n    }\n    /** @internal */\n    onSync(callback) {\n        this.caller.onSync = callback;\n    }\n    /** @internal */\n    inPendingSyncState() {\n        return !this.joinRef || this.joinRef !== this.channel._joinRef();\n    }\n}\nexports.default = RealtimePresence;\n//# sourceMappingURL=RealtimePresence.js.map\n};","~:removed-requires",["~#set",[]],"~:actual-requires",["^5",["~$shadow.js"]],"~:properties",["^5",["joinRef","onSync","onLeave","key","__esModule","newPresences","leaves","enabled","diff","currentPresences","event","leftPresences","onJoin","value","caller","joins","state","channel","pendingDiffs","default","REALTIME_PRESENCE_LISTEN_EVENTS"]],"~:compiled-at",1771725993757,"~:source-map-json","{\n\"version\":3,\n\"file\":\"module$node_modules$$supabase$realtime_js$dist$main$RealtimePresence.js\",\n\"lineCount\":6,\n\"mappings\":\"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\",\n\"sources\":[\"node_modules/@supabase/realtime-js/dist/main/RealtimePresence.js\"],\n\"sourcesContent\":[\"shadow$provide[27] = function(require,module,exports) {\\n\\\"use strict\\\";\\n/*\\n  This file draws heavily from https://github.com/phoenixframework/phoenix/blob/d344ec0a732ab4ee204215b31de69cf4be72e3bf/assets/js/phoenix/presence.js\\n  License: https://github.com/phoenixframework/phoenix/blob/d344ec0a732ab4ee204215b31de69cf4be72e3bf/LICENSE.md\\n*/\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\nexports.REALTIME_PRESENCE_LISTEN_EVENTS = void 0;\\nvar REALTIME_PRESENCE_LISTEN_EVENTS;\\n(function (REALTIME_PRESENCE_LISTEN_EVENTS) {\\n    REALTIME_PRESENCE_LISTEN_EVENTS[\\\"SYNC\\\"] = \\\"sync\\\";\\n    REALTIME_PRESENCE_LISTEN_EVENTS[\\\"JOIN\\\"] = \\\"join\\\";\\n    REALTIME_PRESENCE_LISTEN_EVENTS[\\\"LEAVE\\\"] = \\\"leave\\\";\\n})(REALTIME_PRESENCE_LISTEN_EVENTS || (exports.REALTIME_PRESENCE_LISTEN_EVENTS = REALTIME_PRESENCE_LISTEN_EVENTS = {}));\\nclass RealtimePresence {\\n    /**\\n     * Creates a Presence helper that keeps the local presence state in sync with the server.\\n     *\\n     * @param channel - The realtime channel to bind to.\\n     * @param opts - Optional custom event names, e.g. `{ events: { state: 'state', diff: 'diff' } }`.\\n     *\\n     * @example\\n     * ```ts\\n     * const presence = new RealtimePresence(channel)\\n     *\\n     * channel.on('presence', ({ event, key }) => {\\n     *   console.log(`Presence ${event} on ${key}`)\\n     * })\\n     * ```\\n     */\\n    constructor(channel, opts) {\\n        this.channel = channel;\\n        this.state = {};\\n        this.pendingDiffs = [];\\n        this.joinRef = null;\\n        this.enabled = false;\\n        this.caller = {\\n            onJoin: () => { },\\n            onLeave: () => { },\\n            onSync: () => { },\\n        };\\n        const events = (opts === null || opts === void 0 ? void 0 : opts.events) || {\\n            state: 'presence_state',\\n            diff: 'presence_diff',\\n        };\\n        this.channel._on(events.state, {}, (newState) => {\\n            const { onJoin, onLeave, onSync } = this.caller;\\n            this.joinRef = this.channel._joinRef();\\n            this.state = RealtimePresence.syncState(this.state, newState, onJoin, onLeave);\\n            this.pendingDiffs.forEach((diff) => {\\n                this.state = RealtimePresence.syncDiff(this.state, diff, onJoin, onLeave);\\n            });\\n            this.pendingDiffs = [];\\n            onSync();\\n        });\\n        this.channel._on(events.diff, {}, (diff) => {\\n            const { onJoin, onLeave, onSync } = this.caller;\\n            if (this.inPendingSyncState()) {\\n                this.pendingDiffs.push(diff);\\n            }\\n            else {\\n                this.state = RealtimePresence.syncDiff(this.state, diff, onJoin, onLeave);\\n                onSync();\\n            }\\n        });\\n        this.onJoin((key, currentPresences, newPresences) => {\\n            this.channel._trigger('presence', {\\n                event: 'join',\\n                key,\\n                currentPresences,\\n                newPresences,\\n            });\\n        });\\n        this.onLeave((key, currentPresences, leftPresences) => {\\n            this.channel._trigger('presence', {\\n                event: 'leave',\\n                key,\\n                currentPresences,\\n                leftPresences,\\n            });\\n        });\\n        this.onSync(() => {\\n            this.channel._trigger('presence', { event: 'sync' });\\n        });\\n    }\\n    /**\\n     * Used to sync the list of presences on the server with the\\n     * client's state.\\n     *\\n     * An optional `onJoin` and `onLeave` callback can be provided to\\n     * react to changes in the client's local presences across\\n     * disconnects and reconnects with the server.\\n     *\\n     * @internal\\n     */\\n    static syncState(currentState, newState, onJoin, onLeave) {\\n        const state = this.cloneDeep(currentState);\\n        const transformedState = this.transformState(newState);\\n        const joins = {};\\n        const leaves = {};\\n        this.map(state, (key, presences) => {\\n            if (!transformedState[key]) {\\n                leaves[key] = presences;\\n            }\\n        });\\n        this.map(transformedState, (key, newPresences) => {\\n            const currentPresences = state[key];\\n            if (currentPresences) {\\n                const newPresenceRefs = newPresences.map((m) => m.presence_ref);\\n                const curPresenceRefs = currentPresences.map((m) => m.presence_ref);\\n                const joinedPresences = newPresences.filter((m) => curPresenceRefs.indexOf(m.presence_ref) < 0);\\n                const leftPresences = currentPresences.filter((m) => newPresenceRefs.indexOf(m.presence_ref) < 0);\\n                if (joinedPresences.length > 0) {\\n                    joins[key] = joinedPresences;\\n                }\\n                if (leftPresences.length > 0) {\\n                    leaves[key] = leftPresences;\\n                }\\n            }\\n            else {\\n                joins[key] = newPresences;\\n            }\\n        });\\n        return this.syncDiff(state, { joins, leaves }, onJoin, onLeave);\\n    }\\n    /**\\n     * Used to sync a diff of presence join and leave events from the\\n     * server, as they happen.\\n     *\\n     * Like `syncState`, `syncDiff` accepts optional `onJoin` and\\n     * `onLeave` callbacks to react to a user joining or leaving from a\\n     * device.\\n     *\\n     * @internal\\n     */\\n    static syncDiff(state, diff, onJoin, onLeave) {\\n        const { joins, leaves } = {\\n            joins: this.transformState(diff.joins),\\n            leaves: this.transformState(diff.leaves),\\n        };\\n        if (!onJoin) {\\n            onJoin = () => { };\\n        }\\n        if (!onLeave) {\\n            onLeave = () => { };\\n        }\\n        this.map(joins, (key, newPresences) => {\\n            var _a;\\n            const currentPresences = (_a = state[key]) !== null && _a !== void 0 ? _a : [];\\n            state[key] = this.cloneDeep(newPresences);\\n            if (currentPresences.length > 0) {\\n                const joinedPresenceRefs = state[key].map((m) => m.presence_ref);\\n                const curPresences = currentPresences.filter((m) => joinedPresenceRefs.indexOf(m.presence_ref) < 0);\\n                state[key].unshift(...curPresences);\\n            }\\n            onJoin(key, currentPresences, newPresences);\\n        });\\n        this.map(leaves, (key, leftPresences) => {\\n            let currentPresences = state[key];\\n            if (!currentPresences)\\n                return;\\n            const presenceRefsToRemove = leftPresences.map((m) => m.presence_ref);\\n            currentPresences = currentPresences.filter((m) => presenceRefsToRemove.indexOf(m.presence_ref) < 0);\\n            state[key] = currentPresences;\\n            onLeave(key, currentPresences, leftPresences);\\n            if (currentPresences.length === 0)\\n                delete state[key];\\n        });\\n        return state;\\n    }\\n    /** @internal */\\n    static map(obj, func) {\\n        return Object.getOwnPropertyNames(obj).map((key) => func(key, obj[key]));\\n    }\\n    /**\\n     * Remove 'metas' key\\n     * Change 'phx_ref' to 'presence_ref'\\n     * Remove 'phx_ref' and 'phx_ref_prev'\\n     *\\n     * @example\\n     * // returns {\\n     *  abc123: [\\n     *    { presence_ref: '2', user_id: 1 },\\n     *    { presence_ref: '3', user_id: 2 }\\n     *  ]\\n     * }\\n     * RealtimePresence.transformState({\\n     *  abc123: {\\n     *    metas: [\\n     *      { phx_ref: '2', phx_ref_prev: '1' user_id: 1 },\\n     *      { phx_ref: '3', user_id: 2 }\\n     *    ]\\n     *  }\\n     * })\\n     *\\n     * @internal\\n     */\\n    static transformState(state) {\\n        state = this.cloneDeep(state);\\n        return Object.getOwnPropertyNames(state).reduce((newState, key) => {\\n            const presences = state[key];\\n            if ('metas' in presences) {\\n                newState[key] = presences.metas.map((presence) => {\\n                    presence['presence_ref'] = presence['phx_ref'];\\n                    delete presence['phx_ref'];\\n                    delete presence['phx_ref_prev'];\\n                    return presence;\\n                });\\n            }\\n            else {\\n                newState[key] = presences;\\n            }\\n            return newState;\\n        }, {});\\n    }\\n    /** @internal */\\n    static cloneDeep(obj) {\\n        return JSON.parse(JSON.stringify(obj));\\n    }\\n    /** @internal */\\n    onJoin(callback) {\\n        this.caller.onJoin = callback;\\n    }\\n    /** @internal */\\n    onLeave(callback) {\\n        this.caller.onLeave = callback;\\n    }\\n    /** @internal */\\n    onSync(callback) {\\n        this.caller.onSync = callback;\\n    }\\n    /** @internal */\\n    inPendingSyncState() {\\n        return !this.joinRef || this.joinRef !== this.channel._joinRef();\\n    }\\n}\\nexports.default = RealtimePresence;\\n//# sourceMappingURL=RealtimePresence.js.map\\n};\"],\n\"names\":[\"shadow$provide\",\"require\",\"module\",\"exports\",\"Object\",\"defineProperty\",\"value\",\"REALTIME_PRESENCE_LISTEN_EVENTS\",\"RealtimePresence\",\"constructor\",\"channel\",\"opts\",\"state\",\"pendingDiffs\",\"joinRef\",\"enabled\",\"caller\",\"onJoin\",\"onLeave\",\"onSync\",\"events\",\"diff\",\"_on\",\"newState\",\"_joinRef\",\"syncState\",\"forEach\",\"syncDiff\",\"inPendingSyncState\",\"push\",\"key\",\"currentPresences\",\"newPresences\",\"_trigger\",\"event\",\"leftPresences\",\"currentState\",\"cloneDeep\",\"transformedState\",\"transformState\",\"joins\",\"leaves\",\"map\",\"presences\",\"newPresenceRefs\",\"m\",\"presence_ref\",\"curPresenceRefs\",\"joinedPresences\",\"filter\",\"indexOf\",\"length\",\"_a\",\"joinedPresenceRefs\",\"curPresences\",\"unshift\",\"presenceRefsToRemove\",\"obj\",\"func\",\"getOwnPropertyNames\",\"reduce\",\"metas\",\"presence\",\"JSON\",\"parse\",\"stringify\",\"callback\",\"default\"]\n}\n"]